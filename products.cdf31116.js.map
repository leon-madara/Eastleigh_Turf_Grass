{"version":3,"mappings":"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","names":["Cart","items","appliedCoupon","appliedPromotion","subscribers","getItems","getSubtotal","reduce","sum","it","total","getDiscountAmount","subtotal","discountAmount","couponService","calculateCouponDiscount","discountService","calculatePromotionDiscount","getTotal","render","forEach","callback","e","console","error","window","renderCartUI","add","item","id","Date","now","push","__spreadValues","remove","filter","clear","applyCoupon","code","result","valid","coupon","incrementCouponUsage","applyPromotion","promotionId","promotion","removeDiscount","getAvailablePromotions","getBestPromotion","subscribe","index","indexOf","splice","CartState","Promise","allSettled","__vitePreload","import","then","module","checkoutModal","log","catch","err","warn","discountModal","couponModal","document","addEventListener","__async","exports","grid","getElementById","res","fetch","cache","ok","Error","concat","status","products","json","length","product","card","onAddToCart","fmt","n","Number","isFinite","toLocaleString","el","createElement","className","setAttribute","innerHTML","image","name","thickness","price","useCases","map","u","join","features","f","widthInput","querySelector","heightInput","calcBtn","resultDiv","addToCartBtn","calculationTimeout","validateInputs","w","parseFloat","value","h","classList","width","height","isValid","performCalculation","area","textContent","toFixed","style","display","disabled","dataset","String","debouncedCalculation","clearTimeout","setTimeout","resetCardInputs","focus","target","test","replace","key","preventDefault","cartItem","quantity","CartComponent","createProductCard","appendChild","location","hash","cartSection","scrollIntoView","behavior","block"],"sources":["../src/state/cartState.js.js","../src/js/pages/products.js","../src/ui/components/productCard.js"],"sourcesContent":["// js/state/cartState.js — Central cart state management\r\nimport {\r\n    couponService\r\n} from '../services/couponService.js';\r\nimport {\r\n    discountService\r\n} from '../services/discountService.js';\r\n\r\nconst Cart = (() => {\r\n    let items = []; // Array of { id, product, width, height, area, total }\r\n    let appliedCoupon = null;\r\n    let appliedPromotion = null;\r\n    let subscribers = [];\r\n\r\n    function getItems() {\r\n        return [...items]; // return a shallow copy\r\n    }\r\n\r\n    function add(item) {\r\n        const id = Date.now();\r\n        items.push({\r\n            id,\r\n            ...item\r\n        });\r\n        render();\r\n    }\r\n\r\n    function remove(id) {\r\n        items = items.filter(it => it.id !== id);\r\n        render();\r\n    }\r\n\r\n    function clear() {\r\n        items = [];\r\n        appliedCoupon = null;\r\n        appliedPromotion = null;\r\n        render();\r\n    }\r\n\r\n    function getSubtotal() {\r\n        return items.reduce((sum, it) => sum + it.total, 0);\r\n    }\r\n\r\n    function applyCoupon(code) {\r\n        const subtotal = getSubtotal();\r\n        const result = couponService.applyCoupon(code, subtotal);\r\n\r\n        if (result.valid) {\r\n            appliedCoupon = result.coupon;\r\n            appliedPromotion = null; // Remove any applied promotion\r\n            couponService.incrementCouponUsage(code);\r\n        }\r\n\r\n        render();\r\n        return result;\r\n    }\r\n\r\n    function applyPromotion(promotionId) {\r\n        const subtotal = getSubtotal();\r\n        const result = discountService.applyPromotion(promotionId, subtotal);\r\n\r\n        if (result.valid) {\r\n            appliedPromotion = result.promotion;\r\n            appliedCoupon = null; // Remove any applied coupon\r\n        }\r\n\r\n        render();\r\n        return result;\r\n    }\r\n\r\n    function removeDiscount() {\r\n        appliedCoupon = null;\r\n        appliedPromotion = null;\r\n        render();\r\n    }\r\n\r\n    function getDiscountAmount() {\r\n        const subtotal = getSubtotal();\r\n        let discountAmount = 0;\r\n\r\n        if (appliedCoupon) {\r\n            discountAmount = couponService.calculateCouponDiscount(appliedCoupon, subtotal);\r\n        } else if (appliedPromotion) {\r\n            discountAmount = discountService.calculatePromotionDiscount(appliedPromotion, subtotal);\r\n        }\r\n\r\n        return discountAmount;\r\n    }\r\n\r\n    function getTotal() {\r\n        const subtotal = getSubtotal();\r\n        const discountAmount = getDiscountAmount();\r\n        return subtotal - discountAmount;\r\n    }\r\n\r\n    function getAvailablePromotions() {\r\n        const subtotal = getSubtotal();\r\n        return discountService.getAvailablePromotions(subtotal);\r\n    }\r\n\r\n    function getBestPromotion() {\r\n        const subtotal = getSubtotal();\r\n        return discountService.getBestPromotion(subtotal);\r\n    }\r\n\r\n    function render() {\r\n        const subtotal = getSubtotal();\r\n        const discountAmount = getDiscountAmount();\r\n        const total = getTotal();\r\n\r\n        // Notify all subscribers\r\n        subscribers.forEach(callback => {\r\n            try {\r\n                callback({\r\n                    items: getItems(),\r\n                    subtotal: subtotal,\r\n                    discountAmount: discountAmount,\r\n                    total: total,\r\n                    appliedCoupon: appliedCoupon,\r\n                    appliedPromotion: appliedPromotion\r\n                });\r\n            } catch (e) {\r\n                console.error('Cart subscriber error:', e);\r\n            }\r\n        });\r\n\r\n        // Optional: trigger UI updates\r\n        if (window.renderCartUI) {\r\n            window.renderCartUI(getItems(), total, discountAmount);\r\n        }\r\n    }\r\n\r\n    function subscribe(callback) {\r\n        subscribers.push(callback);\r\n        // Return unsubscribe function\r\n        return () => {\r\n            const index = subscribers.indexOf(callback);\r\n            if (index > -1) {\r\n                subscribers.splice(index, 1);\r\n            }\r\n        };\r\n    }\r\n\r\n    return {\r\n        getItems,\r\n        add,\r\n        remove,\r\n        clear,\r\n        getSubtotal,\r\n        applyCoupon,\r\n        applyPromotion,\r\n        removeDiscount,\r\n        getDiscountAmount,\r\n        getTotal,\r\n        getAvailablePromotions,\r\n        getBestPromotion,\r\n        subscribe\r\n    };\r\n})();\r\n\r\nexport {\r\n    Cart\r\n};","import {\r\n    Cart\r\n} from '../../state/cartState.js';\r\nimport {\r\n    createProductCard\r\n} from '../../ui/components/productCard.js';\r\nimport '../components/header.js';\r\nimport '../components/cart.js';\r\nimport '../components/toast.js';\r\nimport '../../css/header.css';\r\nimport '../../css/toast.css';\r\nimport '../../css/products.css';\r\nimport '../../services/toastService.js';\r\n\r\n// Make Cart state available globally for discount functionality\r\nwindow.CartState = Cart;\r\n\r\n// Ensure all modals are available on products page (optional - don't block if they fail)\r\nPromise.allSettled([\r\n    import('../../ui/checkoutModal.js').then(module => {\r\n        window.checkoutModal = module.checkoutModal;\r\n        console.log('Checkout modal loaded');\r\n    }).catch(err => console.warn('Checkout modal not available:', err)),\r\n    import('../../ui/discountModal.js').then(module => {\r\n        window.discountModal = module.discountModal;\r\n        console.log('Discount modal loaded');\r\n    }).catch(err => console.warn('Discount modal not available:', err)),\r\n    import('../../ui/components/couponModal.js').then(module => {\r\n        window.couponModal = module.couponModal;\r\n        console.log('Coupon modal loaded');\r\n    }).catch(err => console.warn('Coupon modal not available:', err)),\r\n    import('../../ui/BrokerLoginModal.js').then(() => {\r\n        console.log('Broker login modal loaded');\r\n    }).catch(err => console.warn('Broker login modal not available:', err))\r\n]);\r\n\r\n// Products Page Controller\r\n(() => {\r\n    document.addEventListener('DOMContentLoaded', async () => {\r\n        console.log('Products page loaded');\r\n        const grid = document.getElementById('productsGrid');\r\n\r\n        if (!grid) {\r\n            console.error('Products grid not found!');\r\n            return;\r\n        }\r\n\r\n        console.log('Products grid found, loading products...');\r\n\r\n        try {\r\n            // Fetch products data\r\n            const res = await fetch('/src/data/products.json', {\r\n                cache: 'no-cache'\r\n            });\r\n\r\n            if (!res.ok) {\r\n                throw new Error(`HTTP error! status: ${res.status}`);\r\n            }\r\n\r\n            const products = await res.json();\r\n            console.log('Products loaded:', products.length, 'products');\r\n\r\n            products.forEach((product) => {\r\n                const card = createProductCard(product);\r\n                grid.appendChild(card);\r\n            });\r\n\r\n            console.log('Product cards added to grid');\r\n\r\n            // Check if we need to scroll to cart section\r\n            if (window.location.hash === '#cart') {\r\n                setTimeout(() => {\r\n                    const cartSection = document.getElementById('cart');\r\n                    if (cartSection) {\r\n                        cartSection.scrollIntoView({\r\n                            behavior: 'smooth',\r\n                            block: 'start'\r\n                        });\r\n                    }\r\n                }, 500); // Small delay to ensure page is loaded\r\n            }\r\n        } catch (err) {\r\n            console.error('Error loading products:', err);\r\n        }\r\n    });\r\n})();","// ui/productCard.js\r\nexport function createProductCard(product, onAddToCart) {\r\n    const fmt = (n) => Number.isFinite(n) ? n.toLocaleString() : '0';\r\n\r\n    const el = document.createElement('div');\r\n    el.className = 'product-card';\r\n    el.setAttribute('data-product-id', product.id);\r\n\r\n    el.innerHTML = `\r\n    <div class=\"product-image\">\r\n      <img src=\"${product.image}\" alt=\"${product.name}\" />\r\n      <div class=\"product-badges\">\r\n        <div class=\"product-badge\">${product.thickness}</div>\r\n        <div class=\"product-badge price\">\r\n          KES <span class=\"price-amount\">${fmt(product.price)}</span>/m²\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"product-content\">\r\n      <h3 class=\"product-title\">${product.name}</h3>\r\n\r\n      <div class=\"product-section\">\r\n        <h4>Best for</h4>\r\n        <div class=\"use-cases\">\r\n          ${product.useCases.map((u) => `<span class=\"use-case\">${u}</span>`).join('')}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"product-section\">\r\n        <h4>Key Features:</h4>\r\n        <ul class=\"features-list\">\r\n          ${product.features.map((f) => `<li>${f}</li>`).join('')}\r\n        </ul>\r\n      </div>\r\n\r\n      <div class=\"calculator-section\">\r\n        <div class=\"dimension-inputs\">\r\n          <div class=\"input-group\">\r\n            <label>Width (m)</label>\r\n            <input type=\"number\" class=\"width-input\" placeholder=\"0\" min=\"0\" step=\"0.1\" inputmode=\"decimal\" pattern=\"[0-9]*[.]?[0-9]+\" />\r\n          </div>\r\n          <div class=\"input-group\">\r\n            <label>Height (m)</label>\r\n            <input type=\"number\" class=\"height-input\" placeholder=\"0\" min=\"0\" step=\"0.1\" inputmode=\"decimal\" pattern=\"[0-9]*[.]?[0-9]+\" />\r\n          </div>\r\n        </div>\r\n\r\n        <button class=\"calculate-btn\">\r\n          <i class=\"fas fa-calculator\"></i>\r\n          Calculate\r\n        </button>\r\n\r\n        <div class=\"calculation-result\" style=\"display:none;\">\r\n          <div class=\"result-row\">\r\n            <span class=\"area-label\">Area:</span><span class=\"area-value\">0 m²</span>\r\n          </div>\r\n          <div class=\"result-row\">\r\n            <span class=\"unit-price-label\">Unit Price:</span><span class=\"unit-price\">KES 0/m²</span>\r\n          </div>\r\n          <div class=\"result-row\">\r\n            <span class=\"total-label\">Total:</span><span class=\"total-price\">KES 0</span>\r\n          </div>\r\n        </div>\r\n\r\n        <button class=\"add-to-cart-btn\" disabled>\r\n          <i class=\"fas fa-shopping-cart\"></i>\r\n          Add to Cart\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    // Wire calculator\r\n    const widthInput = el.querySelector('.width-input');\r\n    const heightInput = el.querySelector('.height-input');\r\n    const calcBtn = el.querySelector('.calculate-btn');\r\n    const resultDiv = el.querySelector('.calculation-result');\r\n    const addToCartBtn = el.querySelector('.add-to-cart-btn');\r\n\r\n    // Auto-calculation and validation functions\r\n    let calculationTimeout = null;\r\n\r\n    const validateInputs = () => {\r\n        const w = parseFloat(widthInput.value) || 0;\r\n        const h = parseFloat(heightInput.value) || 0;\r\n\r\n        // Clear previous validation states\r\n        widthInput.classList.remove('input-valid', 'input-invalid');\r\n        heightInput.classList.remove('input-valid', 'input-invalid');\r\n\r\n        if (w > 0 && h > 0) {\r\n            widthInput.classList.add('input-valid');\r\n            heightInput.classList.add('input-valid');\r\n            return {\r\n                width: w,\r\n                height: h,\r\n                isValid: true\r\n            };\r\n        } else {\r\n            if (w <= 0 && widthInput.value !== '') {\r\n                widthInput.classList.add('input-invalid');\r\n            }\r\n            if (h <= 0 && heightInput.value !== '') {\r\n                heightInput.classList.add('input-invalid');\r\n            }\r\n            return {\r\n                width: w,\r\n                height: h,\r\n                isValid: false\r\n            };\r\n        }\r\n    };\r\n\r\n    const performCalculation = () => {\r\n        const {\r\n            width,\r\n            height,\r\n            isValid\r\n        } = validateInputs();\r\n\r\n        if (isValid) {\r\n            const area = width * height;\r\n            const total = area * product.price;\r\n\r\n            el.querySelector('.area-value').textContent = `${area.toFixed(2)} m²`;\r\n            el.querySelector('.unit-price').textContent = `KES ${fmt(product.price)}/m²`;\r\n            el.querySelector('.total-price').textContent = `KES ${fmt(total)}`;\r\n\r\n            resultDiv.style.display = 'block';\r\n            addToCartBtn.disabled = false;\r\n\r\n            addToCartBtn.dataset.width = String(width);\r\n            addToCartBtn.dataset.height = String(height);\r\n            addToCartBtn.dataset.area = String(area);\r\n            addToCartBtn.dataset.total = String(total);\r\n        } else {\r\n            resultDiv.style.display = 'none';\r\n            addToCartBtn.disabled = true;\r\n        }\r\n    };\r\n\r\n    const debouncedCalculation = () => {\r\n        if (calculationTimeout) {\r\n            clearTimeout(calculationTimeout);\r\n        }\r\n        calculationTimeout = setTimeout(performCalculation, 300);\r\n    };\r\n\r\n    const resetCardInputs = () => {\r\n        // Clear inputs\r\n        widthInput.value = '';\r\n        heightInput.value = '';\r\n\r\n        // Clear validation states\r\n        widthInput.classList.remove('input-valid', 'input-invalid');\r\n        heightInput.classList.remove('input-valid', 'input-invalid');\r\n\r\n        // Hide results\r\n        resultDiv.style.display = 'none';\r\n        addToCartBtn.disabled = true;\r\n\r\n        // Clear data attributes\r\n        delete addToCartBtn.dataset.width;\r\n        delete addToCartBtn.dataset.height;\r\n        delete addToCartBtn.dataset.area;\r\n        delete addToCartBtn.dataset.total;\r\n\r\n        // Focus back to width input for next calculation\r\n        setTimeout(() => {\r\n            widthInput.focus();\r\n        }, 100);\r\n    };\r\n\r\n    // Auto-calculation on blur\r\n    widthInput.addEventListener('blur', debouncedCalculation);\r\n    heightInput.addEventListener('blur', debouncedCalculation);\r\n\r\n    // Real-time validation on input\r\n    widthInput.addEventListener('input', (e) => {\r\n        // Ensure only numbers and decimal points are allowed\r\n        const value = e.target.value;\r\n        if (value && !/^\\d*\\.?\\d*$/.test(value)) {\r\n            e.target.value = value.replace(/[^\\d.]/g, '');\r\n        }\r\n        validateInputs();\r\n    });\r\n\r\n    heightInput.addEventListener('input', (e) => {\r\n        // Ensure only numbers and decimal points are allowed\r\n        const value = e.target.value;\r\n        if (value && !/^\\d*\\.?\\d*$/.test(value)) {\r\n            e.target.value = value.replace(/[^\\d.]/g, '');\r\n        }\r\n        validateInputs();\r\n    });\r\n\r\n    // Manual calculation button (fallback)\r\n    calcBtn.addEventListener('click', performCalculation);\r\n\r\n    // Keyboard shortcuts\r\n    el.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Enter' && (e.target === widthInput || e.target === heightInput)) {\r\n            e.preventDefault();\r\n            performCalculation();\r\n        } else if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            resetCardInputs();\r\n        }\r\n    });\r\n\r\n    addToCartBtn.addEventListener('click', () => {\r\n        const width = parseFloat(addToCartBtn.dataset.width || '0');\r\n        const height = parseFloat(addToCartBtn.dataset.height || '0');\r\n        const area = parseFloat(addToCartBtn.dataset.area || '0');\r\n        const total = parseFloat(addToCartBtn.dataset.total || '0');\r\n\r\n        const cartItem = {\r\n            id: product.id,\r\n            name: product.name,\r\n            image: product.image,\r\n            price: product.price,\r\n            length: height, // height becomes length\r\n            width: width,\r\n            area: area,\r\n            total: total,\r\n            quantity: 1\r\n        };\r\n\r\n        // Use the cart component system\r\n        if (window.CartComponent) {\r\n            window.CartComponent.add(cartItem);\r\n        }\r\n\r\n        // Also call the callback for backward compatibility\r\n        if (typeof onAddToCart === 'function') {\r\n            onAddToCart(cartItem);\r\n        }\r\n\r\n        // Auto-reset after successful add to cart\r\n        setTimeout(() => {\r\n            resetCardInputs();\r\n        }, 200);\r\n    });\r\n\r\n    return el;\r\n}"],"file":"products.cdf31116.js"}