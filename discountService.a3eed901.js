var f=Object.defineProperty,g=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var d=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var p=(s,o,t)=>o in s?f(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t,m=(s,o)=>{for(var t in o||(o={}))P.call(o,t)&&p(s,t,o[t]);if(d)for(var t of d(o))C.call(o,t)&&p(s,t,o[t]);return s},v=(s,o)=>g(s,h(o));var u=(s,o,t)=>new Promise((e,n)=>{var i=a=>{try{l(t.next(a))}catch(c){n(c)}},r=a=>{try{l(t.throw(a))}catch(c){n(c)}},l=a=>a.done?e(a.value):Promise.resolve(a.value).then(i,r);l((t=t.apply(s,o)).next())});class D{constructor(){this.coupons=[],this.loadCoupons()}loadCoupons(){return u(this,null,function*(){try{const t=yield(yield fetch("/src/data/coupons.json")).json();this.coupons=t.coupons||[]}catch(o){console.error("Error loading coupons:",o),this.coupons=[]}})}validateCoupon(o,t=0){const e=this.coupons.find(l=>l.code.toUpperCase()===o.toUpperCase());if(!e)return{valid:!1,message:"Invalid coupon code"};const n=new Date,i=new Date(e.validFrom),r=new Date(e.validTo);return n<i||n>r?{valid:!1,message:"Coupon has expired or is not yet valid"}:t<e.minOrder?{valid:!1,message:"Minimum order of KES ".concat(e.minOrder.toLocaleString()," required")}:e.usedCount>=e.usageLimit?{valid:!1,message:"Coupon usage limit reached"}:{valid:!0,coupon:e,message:"Coupon applied successfully"}}calculateCouponDiscount(o,t){let e=0;return o.type==="percentage"?e=t*(o.value/100):o.type==="fixed"&&(e=o.value),e>o.maxDiscount&&(e=o.maxDiscount),Math.min(e,t)}applyCoupon(o,t){const e=this.validateCoupon(o,t);if(!e.valid)return e;const n=e.coupon,i=this.calculateCouponDiscount(n,t),r=t-i;return{valid:!0,coupon:n,discountAmount:i,finalTotal:r,message:'Coupon "'.concat(n.code,'" applied! You saved KES ').concat(i.toLocaleString())}}getAvailableCoupons(o=0){return this.coupons.filter(t=>this.validateCoupon(t.code,o).valid)}incrementCouponUsage(o){const t=this.coupons.find(e=>e.code.toUpperCase()===o.toUpperCase());t&&t.usedCount++}}const A=new D;class S{constructor(){this.promotions=[],this.loadPromotions()}loadPromotions(){return u(this,null,function*(){try{const t=yield(yield fetch("/src/data/discounts.json")).json();this.promotions=t.promotions||[]}catch(o){console.error("Error loading promotions:",o),this.promotions=[]}})}getAvailablePromotions(o=0){const t=new Date;return this.promotions.filter(e=>{if(!e.active)return!1;const n=new Date(e.validFrom),i=new Date(e.validTo);return!(t<n||t>i||o<e.minOrder)})}getBestPromotion(o=0){const t=this.getAvailablePromotions(o);return t.length===0?null:t.map(n=>{const i=this.calculatePromotionDiscount(n,o);return v(m({},n),{potentialSavings:i})}).reduce((n,i)=>i.potentialSavings>n.potentialSavings?i:n)}calculatePromotionDiscount(o,t){let e=0;return o.type==="percentage"?e=t*(o.value/100):o.type==="fixed"&&(e=o.value),e>o.maxDiscount&&(e=o.maxDiscount),Math.min(e,t)}applyPromotion(o,t){const e=this.promotions.find(a=>a.id===o);if(!e)return{valid:!1,message:"Promotion not found"};if(!this.getAvailablePromotions(t).some(a=>a.id===o))return{valid:!1,message:"Promotion not available for this order"};const r=this.calculatePromotionDiscount(e,t),l=t-r;return{valid:!0,promotion:e,discountAmount:r,finalTotal:l,message:"".concat(e.name," applied! You saved KES ").concat(r.toLocaleString())}}getPromotionDetails(o){return this.promotions.find(t=>t.id===o)}hasAvailablePromotions(o=0){return this.getAvailablePromotions(o).length>0}getPromotionSummary(o=0){const t=this.getBestPromotion(o);if(!t)return null;const e=this.calculatePromotionDiscount(t,o);return{promotion:t,savings:e,finalTotal:o-e,savingsPercentage:(e/o*100).toFixed(1)}}}const y=new S;export{A as c,y as d};
