class c{constructor(){this.coupons=[],this.loadCoupons()}async loadCoupons(){try{const e=await(await fetch("/src/data/coupons.json")).json();this.coupons=e.coupons||[]}catch(o){console.error("Error loading coupons:",o),this.coupons=[]}}validateCoupon(o,e=0){const t=this.coupons.find(a=>a.code.toUpperCase()===o.toUpperCase());if(!t)return{valid:!1,message:"Invalid coupon code"};const n=new Date,i=new Date(t.validFrom),s=new Date(t.validTo);return n<i||n>s?{valid:!1,message:"Coupon has expired or is not yet valid"}:e<t.minOrder?{valid:!1,message:`Minimum order of KES ${t.minOrder.toLocaleString()} required`}:t.usedCount>=t.usageLimit?{valid:!1,message:"Coupon usage limit reached"}:{valid:!0,coupon:t,message:"Coupon applied successfully"}}calculateCouponDiscount(o,e){let t=0;return o.type==="percentage"?t=e*(o.value/100):o.type==="fixed"&&(t=o.value),t>o.maxDiscount&&(t=o.maxDiscount),Math.min(t,e)}applyCoupon(o,e){const t=this.validateCoupon(o,e);if(!t.valid)return t;const n=t.coupon,i=this.calculateCouponDiscount(n,e),s=e-i;return{valid:!0,coupon:n,discountAmount:i,finalTotal:s,message:`Coupon "${n.code}" applied! You saved KES ${i.toLocaleString()}`}}getAvailableCoupons(o=0){return this.coupons.filter(e=>this.validateCoupon(e.code,o).valid)}incrementCouponUsage(o){const e=this.coupons.find(t=>t.code.toUpperCase()===o.toUpperCase());e&&e.usedCount++}}const d=new c;class u{constructor(){this.promotions=[],this.loadPromotions()}async loadPromotions(){try{const e=await(await fetch("/src/data/discounts.json")).json();this.promotions=e.promotions||[]}catch(o){console.error("Error loading promotions:",o),this.promotions=[]}}getAvailablePromotions(o=0){const e=new Date;return this.promotions.filter(t=>{if(!t.active)return!1;const n=new Date(t.validFrom),i=new Date(t.validTo);return!(e<n||e>i||o<t.minOrder)})}getBestPromotion(o=0){const e=this.getAvailablePromotions(o);return e.length===0?null:e.map(n=>{const i=this.calculatePromotionDiscount(n,o);return{...n,potentialSavings:i}}).reduce((n,i)=>i.potentialSavings>n.potentialSavings?i:n)}calculatePromotionDiscount(o,e){let t=0;return o.type==="percentage"?t=e*(o.value/100):o.type==="fixed"&&(t=o.value),t>o.maxDiscount&&(t=o.maxDiscount),Math.min(t,e)}applyPromotion(o,e){const t=this.promotions.find(r=>r.id===o);if(!t)return{valid:!1,message:"Promotion not found"};if(!this.getAvailablePromotions(e).some(r=>r.id===o))return{valid:!1,message:"Promotion not available for this order"};const s=this.calculatePromotionDiscount(t,e),a=e-s;return{valid:!0,promotion:t,discountAmount:s,finalTotal:a,message:`${t.name} applied! You saved KES ${s.toLocaleString()}`}}getPromotionDetails(o){return this.promotions.find(e=>e.id===o)}hasAvailablePromotions(o=0){return this.getAvailablePromotions(o).length>0}getPromotionSummary(o=0){const e=this.getBestPromotion(o);if(!e)return null;const t=this.calculatePromotionDiscount(e,o);return{promotion:e,savings:t,finalTotal:o-t,savingsPercentage:(t/o*100).toFixed(1)}}}const p=new u;export{d as c,p as d};
//# sourceMappingURL=discountService.775b2253.js.map
