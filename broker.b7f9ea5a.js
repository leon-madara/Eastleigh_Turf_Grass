var ce=Object.defineProperty;var H=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var Q=(s,e,t)=>e in s?ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,z=(s,e)=>{for(var t in e||(e={}))ue.call(e,t)&&Q(s,t,e[t]);if(H)for(var t of H(e))me.call(e,t)&&Q(s,t,e[t]);return s};var pe=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var $=(s,e,t)=>new Promise((r,i)=>{var l=p=>{try{c(t.next(p))}catch(g){i(g)}},u=p=>{try{c(t.throw(p))}catch(g){i(g)}},c=p=>p.done?r(p.value):Promise.resolve(p.value).then(l,u);c((t=t.apply(s,e)).next())});import"./toast.ff58a1ab.js";import"./broker.4ed993c7.js";import{_ as J}from"./toastService.3b9d1098.js";import"./cartIconPopUp.54af95f0.js";var Le=pe(N=>{class ge{constructor(){this.isFormatting=!1}initInputFormatting(e,t={}){if(!e){console.warn("NumberFormatter: No input element provided");return}console.log("NumberFormatter: Initializing formatting for input:",e.id||e.name);const r=z({allowDecimals:!0,decimalPlaces:2,currency:"KES"},t);e._numberFormatterConfig=r,e.addEventListener("input",i=>{this.handleInputFormatting(i)}),e.addEventListener("keydown",i=>{this.handleKeyDown(i)}),e.addEventListener("blur",i=>{this.handleInputBlur(i)}),e.setAttribute("inputmode","decimal"),console.log("NumberFormatter: Formatting initialized successfully for:",e.id||e.name)}handleInputFormatting(e){if(this.isFormatting)return;const t=e.target,r=t._numberFormatterConfig||{},i=t.selectionStart||0,l=t.value;console.log("NumberFormatter: Input event triggered for:",t.id||t.name,"Value:",l);const u=this.countDigitsBeforePosition(l,i);let c=l.replace(/[^\d.]/g,"");if(r.allowDecimals){const b=c.indexOf(".");b!==-1&&(c=c.substring(0,b+1)+c.substring(b+1).replace(/\./g,""))}else c=c.replace(/\./g,"");const p=this.formatNumberWithCommas(c,r);this.isFormatting=!0,t.value=p,this.isFormatting=!1;const g=this.getPositionAfterDigits(p,u);setTimeout(()=>{t.setSelectionRange(g,g)},0)}handleKeyDown(e){e.key==="Enter"&&(e.preventDefault(),e.target.blur())}handleInputBlur(e){const t=e.target,r=t._numberFormatterConfig||{};r.allowDecimals&&this.ensureProperDecimalFormatting(t,r);const i=new CustomEvent("numberFormatted",{detail:{input:t,value:t.value,numericValue:this.parseFormattedNumber(t.value)}});t.dispatchEvent(i)}countDigitsBeforePosition(e,t){let r=0;for(let i=0;i<Math.min(t,e.length);i++)/\d/.test(e[i])&&r++;return r}getPositionAfterDigits(e,t){let r=0,i=0;for(let l=0;l<e.length;l++){if(/\d/.test(e[l])&&(r++,r===t)){i=l+1;break}r<t&&(i=l+1)}return Math.min(i,e.length)}formatNumberWithCommas(e,t={}){if(!e)return"";const{allowDecimals:r=!0,decimalPlaces:i=2}=t;if(r){const l=e.split(".");return l[0]=l[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),l.length>1&&(l[1]=l[1].substring(0,i)),l.join(".")}else return e.replace(/\B(?=(\d{3})+(?!\d))/g,",")}ensureProperDecimalFormatting(e,t={}){const r=e.value,i=this.parseFormattedNumber(r);if(i>0){const l=this.formatCurrency(i,t);e.value=l}}parseFormattedNumber(e){return e&&parseFloat(e.replace(/,/g,""))||0}formatCurrency(e,t={}){const{decimalPlaces:r=2}=t;return e.toLocaleString("en-US",{minimumFractionDigits:r,maximumFractionDigits:r})}formatCurrencyDisplay(e,t={}){const{currency:r="KES"}=t,i=this.formatCurrency(e,t);return"".concat(r," ").concat(i)}}window.numberFormatter=new ge;window.initNumberFormatting=function(s,e={}){window.numberFormatter?window.numberFormatter.initInputFormatting(s,e):console.warn("Number formatter not available")};document.addEventListener("DOMContentLoaded",function(){fe(),De()});function fe(){ye(),be(),he()}function ye(){const s=document.querySelectorAll(".nav-tab"),e=document.querySelectorAll(".tab-content");s.forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-tab");s.forEach(i=>i.classList.remove("active")),e.forEach(i=>i.classList.remove("active")),t.classList.add("active"),document.getElementById("".concat(r,"-content")).classList.add("active")})})}function be(){const s=document.getElementById("addItemBtn");s&&s.addEventListener("click",Se);const e=document.getElementById("submitOrderBtn");e&&e.addEventListener("click",Ie);const t=document.getElementById("addPreorderBtn");t&&t.addEventListener("click",Ee);const r=document.getElementById("submitPreordersBtn");r&&r.addEventListener("click",ve);const i=document.getElementById("addInquiryBtn");i&&i.addEventListener("click",Be);const l=document.getElementById("submitInquiriesBtn");l&&l.addEventListener("click",$e);const u=document.getElementById("logoutBtn");u&&u.addEventListener("click",Y)}function he(){const s=localStorage.getItem("authState");if(s)try{const e=JSON.parse(s);e.loggedIn&&e.user&&we(e.user)}catch(e){console.error("Error parsing auth state:",e)}G()}function G(){const s=document.getElementById("cartCount");if(!s)return;let e=0;window.OrdersModule&&(e+=window.OrdersModule.getItemCount()),window.PreordersModule&&(e+=window.PreordersModule.getItemCount()),window.InquiryModule&&(e+=window.InquiryModule.getItemCount()),s.textContent=e,e>0?s.style.display="block":s.style.display="none"}function we(s){const e=document.getElementById("broker-name"),t=document.getElementById("broker-email");e&&(e.value=s.username||"Broker User"),t&&(t.value=s.email||"broker@eastleighturf.com")}function Se(){window.OrdersModule&&window.OrdersModule.addItem()}function Ie(){window.OrdersModule&&window.OrdersModule.submitOrder()}function Ee(){window.PreordersModule&&window.PreordersModule.addPreorder()}function ve(){window.PreordersModule&&window.PreordersModule.submitPreorders()}function Be(){window.InquiryModule&&window.InquiryModule.addInquiry()}function $e(){window.InquiryModule&&window.InquiryModule.submitInquiries()}function Y(){localStorage.removeItem("authState"),localStorage.removeItem("brokerInfo"),K("Logging out...","success"),window.location.href="/index.html"}function K(s,e="success"){const t=document.getElementById("toast"),r=t.querySelector(".toast-message"),i=t.querySelector(".toast-icon i");r.textContent=s,e==="success"?(i.className="fas fa-check-circle",t.className="toast success"):e==="error"?(i.className="fas fa-exclamation-circle",t.className="toast error"):e==="info"&&(i.className="fas fa-info-circle",t.className="toast info"),t.classList.remove("hidden"),setTimeout(()=>{A()},4e3)}function A(){document.getElementById("toast").classList.add("hidden")}function De(){setTimeout(()=>{K("Login Successful\nWelcome to your broker dashboard.","success")},500)}window.BrokerDashboard={showToast:K,hideToast:A,handleLogout:Y,updateCartCount:G};document.addEventListener("click",function(s){s.target.classList.contains("toast-close")&&A()});class Fe{constructor(){this.elements={orderTotalSpan:document.getElementById("orderTotal"),amountToPayInput:document.getElementById("amount-to-pay-input"),creditBalanceSpan:document.getElementById("credit-balance")},this.initialize()}initialize(){if(console.log("PaymentSummaryHandler: Initializing..."),!this.areElementsValid()){console.warn("Payment summary elements not found");return}console.log("PaymentSummaryHandler: Elements found, setting up event listeners..."),this.setupEventListeners(),this.updateCreditBalance(),console.log("PaymentSummaryHandler: Initialization complete")}areElementsValid(){const{orderTotalSpan:e,amountToPayInput:t,creditBalanceSpan:r}=this.elements;return!!(e&&t&&r)}setupEventListeners(){const{amountToPayInput:e}=this.elements;e&&(this.initializeNumberFormatting(),e.addEventListener("numberFormatted",()=>{this.updateCreditBalance()}),e.addEventListener("blur",()=>{this.updateCreditBalance()}),e.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),e.blur())}))}initializeNumberFormatting(){const{amountToPayInput:e}=this.elements;if(console.log("PaymentSummaryHandler: Initializing number formatting..."),console.log("PaymentSummaryHandler: numberFormatter available?",!!window.numberFormatter),window.numberFormatter)console.log("PaymentSummaryHandler: Using number formatter"),window.numberFormatter.initInputFormatting(e,{allowDecimals:!0,decimalPlaces:2,currency:"KES"});else{console.log("PaymentSummaryHandler: Waiting for number formatter...");const t=setInterval(()=>{window.numberFormatter&&(console.log("PaymentSummaryHandler: Number formatter now available, initializing..."),window.numberFormatter.initInputFormatting(e,{allowDecimals:!0,decimalPlaces:2,currency:"KES"}),clearInterval(t))},100)}}updateCreditBalance(){const{orderTotalSpan:e,amountToPayInput:t,creditBalanceSpan:r}=this.elements;if(!e||!t||!r){console.warn("Cannot update credit balance: missing elements");return}const i=window.numberFormatter?window.numberFormatter.parseFormattedNumber(e.textContent||""):0,l=window.numberFormatter?window.numberFormatter.parseFormattedNumber(t.value):0,u=Math.max(0,i-l);r.textContent=window.numberFormatter?window.numberFormatter.formatCurrency(u):u.toFixed(2)}}function V(){window.paymentSummaryHandler=new Fe}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",V):V();(()=>{let s=[],e=[],t=1,r=null,i=[],l=[],u=null,c=null;function p(){return $(this,null,function*(){yield g(),yield b(),yield E(),y(),D(),S()})}function g(){return $(this,null,function*(){try{s=yield(yield fetch("/src/data/products.json")).json(),console.log("Products loaded:",s.length,"products")}catch(n){console.error("Failed to load products:",n),h("Failed to load products","error")}})}function b(){return $(this,null,function*(){try{i=(yield(yield fetch("/src/data/discounts.json")).json()).promotions.filter(o=>o.active),console.log("Discounts loaded:",i.length,"active discounts")}catch(n){console.error("Failed to load discounts:",n),i=[]}})}function E(){return $(this,null,function*(){try{l=(yield(yield fetch("/src/data/coupons.json")).json()).coupons.filter(o=>o.usedCount<o.usageLimit&&new Date>=new Date(o.validFrom)&&new Date<=new Date(o.validTo)),console.log("Coupons loaded:",l.length,"available coupons")}catch(n){console.error("Failed to load coupons:",n),l=[]}})}function y(){const n=localStorage.getItem("brokerInfo");n?r=JSON.parse(n):r={id:"BROKER001",name:"Broker User",email:"broker@eastleighturf.com",phone:"+254700000000"}}function S(){const n=document.getElementById("addItemBtn"),a=document.getElementById("submitOrderBtn");n&&n.addEventListener("click",x),a&&a.addEventListener("click",j)}function x(){X();const n=document.getElementById("addItemModal");n&&(n.style.display="flex",L())}function X(){const n=document.getElementById("addItemModal");n&&n.remove();const a='\n            <div id="addItemModal" class="modal-overlay">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Add Order Item</h2>\n                        <button class="modal-close" id="closeAddItemModal" aria-label="Close modal">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    </div>\n                    <div class="modal-body">\n                        <form id="addItemForm">\n                            <div class="form-group">\n                                <label for="modalProduct">Product *</label>\n                                <select id="modalProduct" required>\n                                    <option value="">Select a product</option>\n                                    '.concat(s.map(o=>'<option value="'.concat(o.id,'">').concat(o.name," (").concat(o.thickness,")</option>")).join(""),'\n                                </select>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="modalQuantity">Quantity (m²) *</label>\n                                <input type="number" id="modalQuantity" min="0.1" step="0.1" required placeholder="Enter quantity">\n                            </div>\n\n                            <div class="form-group">\n                                <label>Unit Price (KES)</label>\n                                <input type="text" id="modalUnitPrice" readonly value="0">\n                            </div>\n\n                            <div class="form-group">\n                                <label>Subtotal (KES)</label>\n                                <input type="text" id="modalSubtotal" readonly value="0">\n                            </div>\n\n                            <div class="discount-section">\n                                <h3>Discounts & Coupons</h3>\n                                \n                                <div class="form-group">\n                                    <label for="modalDiscount">Available Discounts</label>\n                                    <select id="modalDiscount" disabled>\n                                        <option value="">No discount</option>\n                                        ').concat(i.map(o=>'<option value="'.concat(o.id,'">').concat(o.name," - ").concat(o.description,"</option>")).join(""),'\n                                    </select>\n                                </div>\n\n                                <div class="form-group">\n                                    <label for="modalCoupon">Coupon Code</label>\n                                    <div class="coupon-input-group">\n                                        <input type="text" id="modalCoupon" placeholder="Enter coupon code" disabled>\n                                        <button type="button" id="applyCouponBtn" disabled>Apply</button>\n                                    </div>\n                                </div>\n\n                                <div class="discount-summary" id="discountSummary" style="display: none;">\n                                    <div class="summary-row">\n                                        <span>Subtotal:</span>\n                                        <span id="summarySubtotal">KES 0</span>\n                                    </div>\n                                    <div class="summary-row discount-row" id="discountRow" style="display: none;">\n                                        <span>Discount:</span>\n                                        <span id="summaryDiscount">-KES 0</span>\n                                    </div>\n                                    <div class="summary-row coupon-row" id="couponRow" style="display: none;">\n                                        <span>Coupon:</span>\n                                        <span id="summaryCoupon">-KES 0</span>\n                                    </div>\n                                    <div class="summary-row final-total">\n                                        <span>Final Total:</span>\n                                        <span id="summaryFinalTotal">KES 0</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </form>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-secondary" id="cancelAddItem">Cancel</button>\n                        <button type="button" class="btn btn-primary" id="confirmAddItem" disabled>Add to Order</button>\n                    </div>\n                </div>\n            </div>\n        ');document.body.insertAdjacentHTML("beforeend",a),Z()}function Z(){const n=document.getElementById("addItemModal"),a=document.getElementById("closeAddItemModal"),o=document.getElementById("cancelAddItem"),d=document.getElementById("confirmAddItem"),m=document.getElementById("modalProduct"),f=document.getElementById("modalQuantity"),w=document.getElementById("applyCouponBtn");if(a&&a.addEventListener("click",P),o&&o.addEventListener("click",P),d&&d.addEventListener("click",ae),m&&m.addEventListener("change",ee),f)if(f.addEventListener("input",te),window.numberFormatter)window.numberFormatter.initInputFormatting(f,{allowDecimals:!0,decimalPlaces:1,currency:"KES"});else{const F=setInterval(()=>{window.numberFormatter&&(window.numberFormatter.initInputFormatting(f,{allowDecimals:!0,decimalPlaces:1,currency:"KES"}),clearInterval(F))},100)}w&&w.addEventListener("click",oe),n&&n.addEventListener("click",F=>{F.target===n&&P()})}function ee(){const n=document.getElementById("modalProduct");document.getElementById("modalQuantity");const a=document.getElementById("modalUnitPrice"),o=document.getElementById("modalSubtotal");if(n&&n.value){const d=s.find(m=>m.id===n.value);d&&(a.value=d.price.toLocaleString("en-US"),q(),U())}else a.value="0",o.value="0",L()}function te(){q(),U()}function q(){const n=document.getElementById("modalProduct"),a=document.getElementById("modalQuantity"),o=document.getElementById("modalSubtotal");if(n&&n.value&&a&&a.value){const d=s.find(w=>w.id===n.value),m=window.numberFormatter?window.numberFormatter.parseFormattedNumber(a.value):parseFloat(a.value)||0,f=d.price*m;o.value=window.numberFormatter?window.numberFormatter.formatCurrency(f):f.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),C()}else o.value="0"}function U(){const n=document.getElementById("modalProduct"),a=document.getElementById("modalQuantity");document.getElementById("modalDiscount"),document.getElementById("modalCoupon"),document.getElementById("applyCouponBtn");const o=document.getElementById("confirmAddItem"),d=n&&n.value,m=a&&a.value&&(window.numberFormatter?window.numberFormatter.parseFormattedNumber(a.value):parseFloat(a.value))>0;d&&m?(ne(),o&&(o.disabled=!1)):(L(),o&&(o.disabled=!0))}function ne(){const n=document.getElementById("modalDiscount"),a=document.getElementById("modalCoupon"),o=document.getElementById("applyCouponBtn");n&&(n.disabled=!1),a&&(a.disabled=!1),o&&(o.disabled=!1),n&&n.addEventListener("change",C)}function L(){const n=document.getElementById("modalDiscount"),a=document.getElementById("modalCoupon"),o=document.getElementById("applyCouponBtn");n&&(n.disabled=!0,n.value=""),a&&(a.disabled=!0,a.value=""),o&&(o.disabled=!0),u=null,c=null,C()}function oe(){const a=document.getElementById("modalCoupon").value.trim().toUpperCase();if(!a){h("Please enter a coupon code","error");return}const o=l.find(m=>m.code===a);if(!o){h("Invalid coupon code","error");return}if(k()<o.minOrder){h("Minimum order amount for this coupon is KES ".concat(o.minOrder.toLocaleString()),"error");return}c=o,h("Coupon ".concat(o.code," applied successfully!"),"success"),C()}function C(){const n=k(),a=document.getElementById("discountSummary"),o=document.getElementById("summarySubtotal"),d=document.getElementById("discountRow"),m=document.getElementById("summaryDiscount"),f=document.getElementById("couponRow"),w=document.getElementById("summaryCoupon"),F=document.getElementById("summaryFinalTotal");if(!a)return;o.textContent="KES ".concat(n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));let M=n,v=0,B=0;const O=document.getElementById("modalDiscount");if(O&&O.value){const I=i.find(de=>de.id===O.value);I&&n>=I.minOrder&&(I.type==="percentage"?(v=n*I.value/100,I.maxDiscount&&(v=Math.min(v,I.maxDiscount))):v=I.value,M-=v,u=I)}c&&(c.type==="percentage"?(B=n*c.value/100,c.maxDiscount&&(B=Math.min(B,c.maxDiscount))):B=c.value,M-=B),v>0?(d.style.display="flex",m.textContent="-KES ".concat(v.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))):d.style.display="none",B>0?(f.style.display="flex",w.textContent="-KES ".concat(B.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))):f.style.display="none",F.textContent="KES ".concat(M.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),a.style.display="block"}function k(){const n=document.getElementById("modalProduct"),a=document.getElementById("modalQuantity");if(n&&n.value&&a&&a.value){const o=s.find(m=>m.id===n.value),d=parseFloat(a.value)||0;return o.price*d}return 0}function ae(){const n=document.getElementById("modalProduct"),a=document.getElementById("modalQuantity");if(!n.value||!a.value){h("Please select a product and enter quantity","error");return}const o=s.find(w=>w.id===n.value),d=parseFloat(a.value),m=k(),f={id:t++,productId:o.id,product:o,quantity:d,unitPrice:o.price,subtotal:m,discount:u,coupon:c,finalTotal:m-(u?R(m,u):0)-(c?W(m,c):0)};e.push(f),P(),D(),h("Item added to order","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function R(n,a){if(a.type==="percentage"){let o=n*a.value/100;return a.maxDiscount&&(o=Math.min(o,a.maxDiscount)),o}return a.value}function W(n,a){if(a.type==="percentage"){let o=n*a.value/100;return a.maxDiscount&&(o=Math.min(o,a.maxDiscount)),o}return a.value}function P(){const n=document.getElementById("addItemModal");n&&n.remove(),u=null,c=null}function _(n){e=e.filter(a=>a.id!==n),D(),h("Item removed from order","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function T(){return e.reduce((n,a)=>n+a.finalTotal,0)}function D(){const n=document.getElementById("orderTableBody"),a=document.getElementById("emptyOrderState"),o=document.getElementById("orderTotal"),d=document.getElementById("submitOrderBtn");if(!n||!a||!o||!d)return;e.length===0?(n.innerHTML="",a.style.display="block",d.disabled=!0):(a.style.display="none",d.disabled=!1,n.innerHTML=e.map(f=>re(f)).join(""),e.forEach(f=>{const w=document.getElementById("delete-".concat(f.id));w&&w.addEventListener("click",()=>{_(f.id)})}));const m=T();o.textContent=m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),window.paymentSummaryHandler&&window.paymentSummaryHandler.updateCreditBalance&&window.paymentSummaryHandler.updateCreditBalance()}function re(n){const a=n.discount?"".concat(n.discount.name," (-").concat(n.discount.value,"%)"):"",o=n.coupon?"".concat(n.coupon.code," (-").concat(n.coupon.value).concat(n.coupon.type==="percentage"?"%":" KES",")"):"";return'\n            <tr>\n                <td>\n                    <div class="order-field">\n                        <label>Product Name</label>\n                        <strong>'.concat(n.product.name," (").concat(n.product.thickness,')</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Quantity (m²)</label>\n                        <strong>').concat(n.quantity,'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Unit Price (KES)</label>\n                        <strong>').concat(n.unitPrice.toLocaleString("en-US"),'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Subtotal (KES)</label>\n                        <strong>').concat(n.subtotal.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Final Total (KES)</label>\n                        <strong>').concat(n.finalTotal.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),"</strong>\n                        ").concat(a||o?'<br><small class="discount-info">'.concat(a).concat(a&&o?", ":"").concat(o,"</small>"):"",'\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Action</label>\n                        <button class="delete-btn" id="delete-').concat(n.id,'">\n                            <i class="fas fa-trash"></i> Delete\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        ')}function j(){if(e.length===0){h("No items in order","error");return}const n={brokerId:r.id,brokerName:r.name,brokerEmail:r.email,brokerPhone:r.phone,items:e,total:T(),subtotal:e.reduce((a,o)=>a+o.subtotal,0),totalDiscount:e.reduce((a,o)=>{let d=0;return o.discount&&(d+=R(o.subtotal,o.discount)),o.coupon&&(d+=W(o.subtotal,o.coupon)),a+d},0),orderDate:new Date().toISOString()};ie(n)}function ie(n){const a=se(n);if(window.WhatsAppService&&window.WhatsAppService.sendToWhatsApp)window.WhatsAppService.sendToWhatsApp(a,"broker-order")?(h("Order sent to WhatsApp successfully!","success"),e=[],D()):h("Failed to send order to WhatsApp","error");else{const o="254743375997",d=encodeURIComponent(a),m="https://wa.me/".concat(o,"?text=").concat(d);window.open(m,"_blank"),h("Order opened in WhatsApp!","success"),e=[],D()}}function se(n){const a=n.items.map(o=>{let d="• ".concat(o.product.name," (").concat(o.product.thickness,")\n");return d+="  Quantity: ".concat(o.quantity," m²\n"),d+="  Unit Price: KES ".concat(o.unitPrice.toLocaleString(),"\n"),d+="  Subtotal: KES ".concat(o.subtotal.toLocaleString()),(o.discount||o.coupon)&&(d+="\n  Final Total: KES ".concat(o.finalTotal.toLocaleString()),o.discount&&(d+=" (".concat(o.discount.name," applied)")),o.coupon&&(d+=" (".concat(o.coupon.code," applied)"))),d}).join("\n\n");return"*BROKER ORDER SUBMISSION - Eastleigh Turf Grass*\n\n*Broker Details:*\n• ID: ".concat(n.brokerId,"\n• Name: ").concat(n.brokerName,"\n• Email: ").concat(n.brokerEmail,"\n• Phone: ").concat(n.brokerPhone,"\n\n*Order Items:*\n").concat(a,"\n\n*Order Summary:*\n• Total Items: ").concat(n.items.length,"\n• Subtotal: KES ").concat(n.subtotal.toLocaleString(),"\n• Total Discount: KES ").concat(n.totalDiscount.toLocaleString(),"\n• Final Total: KES ").concat(n.total.toLocaleString(),"\n\n*Submitted:* ").concat(new Date().toLocaleString("en-KE"))}function h(n,a="success"){const o=document.getElementById("toast"),d=o.querySelector(".toast-message");o&&d&&(o.className="toast ".concat(a),d.textContent=n,o.classList.remove("hidden"),setTimeout(()=>{o.classList.add("hidden")},3e3))}function le(){return e.length}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>$(N,null,function*(){yield p()})):$(N,null,function*(){yield p()}),window.OrdersModule={addItem:x,removeItem:_,getItemCount:le,calculateTotal:T,updateUI:D,submitOrder:j}})();class Ce{constructor(){this.whatsappNumber="254743375997",this.businessName="Eastleigh Turf Grass",this.baseUrl="https://wa.me"}sendOrder(e){try{const t=this.generateOrderMessage(e),r=this.generateWhatsAppUrl(t);return window.open(r,"_blank"),!0}catch(t){return console.error("WhatsApp Service Error:",t),!1}}sendPreorder(e){try{const t=this.generatePreorderMessage(e),r=this.generateWhatsAppUrl(t);return window.open(r,"_blank"),!0}catch(t){return console.error("WhatsApp Service Error:",t),!1}}sendInquiry(e){try{const t=this.generateInquiryMessage(e),r=this.generateWhatsAppUrl(t);return window.open(r,"_blank"),!0}catch(t){return console.error("WhatsApp Service Error:",t),!1}}sendContact(e){try{const t=this.generateContactMessage(e),r=this.generateWhatsAppUrl(t);return window.open(r,"_blank"),!0}catch(t){return console.error("WhatsApp Service Error:",t),!1}}generateWhatsAppUrl(e){const t=encodeURIComponent(e);return"".concat(this.baseUrl,"/").concat(this.whatsappNumber,"?text=").concat(t)}generateOrderMessage(e){const{brokerId:t,brokerName:r,brokerEmail:i,brokerPhone:l,items:u,total:c,subtotal:p,totalDiscount:g,orderDate:b}=e,E=u.map(y=>{let S="• ".concat(y.product.name," (").concat(y.product.thickness,")\n");return S+="  Quantity: ".concat(y.quantity," m²\n"),S+="  Unit Price: KES ".concat(y.unitPrice.toLocaleString(),"\n"),S+="  Subtotal: KES ".concat(y.subtotal.toLocaleString()),(y.discount||y.coupon)&&(S+="\n  Final Total: KES ".concat(y.finalTotal.toLocaleString()),y.discount&&(S+=" (".concat(y.discount.name," applied)")),y.coupon&&(S+=" (".concat(y.coupon.code," applied)"))),S}).join("\n\n");return"*BROKER ORDER SUBMISSION - ".concat(this.businessName,"*\n\n*Broker Details:*\n• ID: ").concat(t,"\n• Name: ").concat(r,"\n• Email: ").concat(i,"\n• Phone: ").concat(l,"\n\n*Order Items:*\n").concat(E,"\n\n*Order Summary:*\n• Total Items: ").concat(u.length,"\n• Subtotal: KES ").concat(p.toLocaleString(),"\n• Total Discount: KES ").concat(g.toLocaleString(),"\n• Final Total: KES ").concat(c.toLocaleString(),"\n\n*Submitted:* ").concat(new Date(b).toLocaleString("en-KE"))}generatePreorderMessage(e){const{brokerName:t,brokerEmail:r,items:i,expectedDate:l,specialNotes:u,total:c}=e,p=i.map(g=>"• ".concat(g.product.name," (").concat(g.product.thickness,")\n  Quantity: ").concat(g.quantity," m²\n  Unit Price: KES ").concat(g.unitPrice.toLocaleString(),"\n  Total: KES ").concat(g.total.toLocaleString())).join("\n\n");return"*BROKER PREORDER SUBMISSION - ".concat(this.businessName,"*\n\n*Broker Details:*\n• Name: ").concat(t,"\n• Email: ").concat(r,"\n\n*Preorder Items:*\n").concat(p,"\n\n*Preorder Details:*\n• Expected Date: ").concat(l||"Not specified","\n• Special Notes: ").concat(u||"None","\n• Total Amount: KES ").concat(c.toLocaleString(),"\n\n*Submitted:* ").concat(new Date().toLocaleString("en-KE"))}generateInquiryMessage(e){const{brokerName:t,brokerEmail:r,items:i,totalOriginal:l,totalBargain:u}=e,c=i.map(b=>{const E=b.bargainPrice-b.originalPrice,y=E>0?"+KES ".concat(E.toLocaleString()):"-KES ".concat(Math.abs(E).toLocaleString());return"• ".concat(b.product.name," (").concat(b.product.thickness,")\n  Original Price: KES ").concat(b.originalPrice.toLocaleString(),"\n  Bargain Price: KES ").concat(b.bargainPrice.toLocaleString(),"\n  Difference: ").concat(y)}).join("\n\n"),p=u-l,g=p>0?"+KES ".concat(p.toLocaleString()):"-KES ".concat(Math.abs(p).toLocaleString());return"*BROKER PRICE INQUIRY - ".concat(this.businessName,"*\n\n*Broker Details:*\n• Name: ").concat(t,"\n• Email: ").concat(r,"\n\n*Price Inquiries:*\n").concat(c,"\n\n*Inquiry Summary:*\n• Total Original Value: KES ").concat(l.toLocaleString(),"\n• Total Bargain Value: KES ").concat(u.toLocaleString(),"\n• Total Difference: ").concat(g,"\n\n*Submitted:* ").concat(new Date().toLocaleString("en-KE"))}generateContactMessage(e){const{name:t,email:r,phone:i,subject:l,message:u}=e;return"*CONTACT FORM SUBMISSION - ".concat(this.businessName,"*\n\n*Customer Details:*\n• Name: ").concat(t,"\n• Email: ").concat(r,"\n• Phone: ").concat(i,"\n\n*Message:*\nSubject: ").concat(l,"\nMessage: ").concat(u,"\n\n*Submitted:* ").concat(new Date().toLocaleString("en-KE"))}sendToWhatsApp(e,t="general"){try{const r=this.generateWhatsAppUrl(e);return window.open(r,"_blank"),!0}catch(r){return console.error("WhatsApp Service Error:",r),!1}}sendOrderForm(e){return this.sendOrder(e)}sendPreorderForm(e){return this.sendPreorder(e)}sendInquiryForm(e){return this.sendInquiry(e)}sendContactForm(e){return this.sendContact(e)}}const Pe=new Ce;window.WhatsAppService=Pe;try{J(()=>import("./preorders.0aa4bddc.js"),[])}catch(s){console.warn("Preorders module not available:",s)}try{J(()=>import("./inquiry.504811e8.js"),[])}catch(s){console.warn("Inquiry module not available:",s)}document.addEventListener("DOMContentLoaded",function(){console.log("Broker dashboard initialized");const s=localStorage.getItem("authState");if(!s){window.location.href="/index.html";return}try{const e=JSON.parse(s);if(!e.loggedIn||!e.user){window.location.href="/index.html";return}const t={id:"BROKER001",name:e.user.username||"Broker User",email:e.user.email||"broker@eastleighturf.com",phone:e.user.phone||"+254700000000"};localStorage.setItem("brokerInfo",JSON.stringify(t))}catch(e){console.error("Error parsing auth state:",e),window.location.href="/index.html";return}window.BrokerDashboard?console.log("Broker dashboard modules loaded successfully"):console.error("Broker dashboard modules failed to load")})});export default Le();
