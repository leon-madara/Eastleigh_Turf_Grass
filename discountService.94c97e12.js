var o=Object.defineProperty,t=Object.defineProperties,e=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,e,n)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,s=(o,t,e)=>new Promise((n,i)=>{var r=o=>{try{s(e.next(o))}catch(t){i(t)}},a=o=>{try{s(e.throw(o))}catch(t){i(t)}},s=o=>o.done?n(o.value):Promise.resolve(o.value).then(r,a);s((e=e.apply(o,t)).next())});const c=new class{constructor(){this.coupons=[],this.loadCoupons()}loadCoupons(){return s(this,null,function*(){try{const o=yield fetch("/src/data/coupons.json"),t=yield o.json();this.coupons=t.coupons||[]}catch(o){console.error("Error loading coupons:",o),this.coupons=[]}})}validateCoupon(o,t=0){const e=this.coupons.find(t=>t.code.toUpperCase()===o.toUpperCase());if(!e)return{valid:!1,message:"Invalid coupon code"};const n=new Date,i=new Date(e.validFrom),r=new Date(e.validTo);return n<i||n>r?{valid:!1,message:"Coupon has expired or is not yet valid"}:t<e.minOrder?{valid:!1,message:"Minimum order of KES ".concat(e.minOrder.toLocaleString()," required")}:e.usedCount>=e.usageLimit?{valid:!1,message:"Coupon usage limit reached"}:{valid:!0,coupon:e,message:"Coupon applied successfully"}}calculateCouponDiscount(o,t){let e=0;return"percentage"===o.type?e=t*(o.value/100):"fixed"===o.type&&(e=o.value),e>o.maxDiscount&&(e=o.maxDiscount),Math.min(e,t)}applyCoupon(o,t){const e=this.validateCoupon(o,t);if(!e.valid)return e;const n=e.coupon,i=this.calculateCouponDiscount(n,t);return{valid:!0,coupon:n,discountAmount:i,finalTotal:t-i,message:'Coupon "'.concat(n.code,'" applied! You saved KES ').concat(i.toLocaleString())}}getAvailableCoupons(o=0){return this.coupons.filter(t=>this.validateCoupon(t.code,o).valid)}incrementCouponUsage(o){const t=this.coupons.find(t=>t.code.toUpperCase()===o.toUpperCase());t&&t.usedCount++}};const l=new class{constructor(){this.promotions=[],this.loadPromotions()}loadPromotions(){return s(this,null,function*(){try{const o=yield fetch("/src/data/discounts.json"),t=yield o.json();this.promotions=t.promotions||[]}catch(o){console.error("Error loading promotions:",o),this.promotions=[]}})}getAvailablePromotions(o=0){const t=new Date;return this.promotions.filter(e=>{if(!e.active)return!1;const n=new Date(e.validFrom),i=new Date(e.validTo);return!(t<n||t>i)&&!(o<e.minOrder)})}getBestPromotion(o=0){const s=this.getAvailablePromotions(o);if(0===s.length)return null;return s.map(s=>{const c=this.calculatePromotionDiscount(s,o);return l=((o,t)=>{for(var e in t||(t={}))i.call(t,e)&&a(o,e,t[e]);if(n)for(var e of n(t))r.call(t,e)&&a(o,e,t[e]);return o})({},s),t(l,e({potentialSavings:c}));var l}).reduce((o,t)=>t.potentialSavings>o.potentialSavings?t:o)}calculatePromotionDiscount(o,t){let e=0;return"percentage"===o.type?e=t*(o.value/100):"fixed"===o.type&&(e=o.value),e>o.maxDiscount&&(e=o.maxDiscount),Math.min(e,t)}applyPromotion(o,t){const e=this.promotions.find(t=>t.id===o);if(!e)return{valid:!1,message:"Promotion not found"};if(!this.getAvailablePromotions(t).some(t=>t.id===o))return{valid:!1,message:"Promotion not available for this order"};const n=this.calculatePromotionDiscount(e,t);return{valid:!0,promotion:e,discountAmount:n,finalTotal:t-n,message:"".concat(e.name," applied! You saved KES ").concat(n.toLocaleString())}}getPromotionDetails(o){return this.promotions.find(t=>t.id===o)}hasAvailablePromotions(o=0){return this.getAvailablePromotions(o).length>0}getPromotionSummary(o=0){const t=this.getBestPromotion(o);if(!t)return null;const e=this.calculatePromotionDiscount(t,o);return{promotion:t,savings:e,finalTotal:o-e,savingsPercentage:(e/o*100).toFixed(1)}}};export{c,l as d};
//# sourceMappingURL=discountService.94c97e12.js.map
