{"version":3,"file":"checkoutModal-87881386.js","sources":["../../src/ui/checkoutModal.js"],"sourcesContent":["// Checkout Modal Component\r\nexport const checkoutModal = {\r\n    modal: null,\r\n    isInitialized: false,\r\n\r\n    init() {\r\n        console.log('Checkout modal initialized');\r\n        this.isInitialized = true;\r\n    },\r\n\r\n    async open() {\r\n        await this.createModal();\r\n        this.showModal();\r\n        // Initialize step state\r\n        this.currentStep = 1;\r\n        this.totalSteps = 3;\r\n    },\r\n\r\n    close() {\r\n        this.hideModal();\r\n    },\r\n\r\n    async createModal() {\r\n        // Remove existing modal if any\r\n        const existingModal = document.getElementById('checkoutModal');\r\n        if (existingModal) {\r\n            existingModal.remove();\r\n        }\r\n\r\n        try {\r\n            // Load the HTML partial\r\n            const response = await fetch('/src/public/partials/checkout-modal.html');\r\n            if (!response.ok) {\r\n                throw new Error(`Failed to load HTML partial: ${response.status}`);\r\n            }\r\n\r\n            const modalHTML = await response.text();\r\n            document.body.insertAdjacentHTML('beforeend', modalHTML);\r\n\r\n            // Initialize the modal\r\n            this.initializeModal();\r\n            this.bindEvents();\r\n            this.updateStepIndicator();\r\n            this.updateOrderSummary();\r\n\r\n        } catch (error) {\r\n            console.error('Error loading checkout modal:', error);\r\n            // Fallback to basic modal if partial fails to load\r\n            this.createFallbackModal();\r\n        }\r\n    },\r\n\r\n    createFallbackModal() {\r\n        const modalHTML = `\r\n            <div id=\"checkoutModal\" class=\"checkout-modal active\">\r\n                <div class=\"modal-overlay\"></div>\r\n                <div class=\"modal-content\">\r\n                    <div class=\"modal-header\">                        \r\n                        <button class=\"modal-close\" id=\"closeCheckoutModal\" aria-label=\"Close modal\">\r\n                            <i class=\"fas fa-times\"></i>\r\n                        <h2>Checkout</h2>\r\n                        </button>\r\n                    </div>\r\n                    <div class=\"modal-body\">\r\n                        <p>Error loading checkout form. Please try again.</p>\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn-secondary\" id=\"closeCheckoutModal\">Close</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n        document.body.insertAdjacentHTML('beforeend', modalHTML);\r\n        this.bindEvents();\r\n    },\r\n\r\n    initializeModal() {\r\n        // Initialize step state\r\n        this.currentStep = 1;\r\n        this.totalSteps = 3;\r\n\r\n        console.log('Modal initialized, currentStep:', this.currentStep);\r\n\r\n        // Show first step\r\n        this.showStep(1);\r\n\r\n        // Update button states\r\n        this.updateButtonStates();\r\n\r\n        // Populate order summary with cart data\r\n        this.populateOrderSummary();\r\n\r\n        // Debug: Check if back button exists\r\n        const backBtn = document.getElementById('backBtn');\r\n        console.log('Back button in initializeModal:', backBtn);\r\n        if (backBtn) {\r\n            console.log('Back button styles:', backBtn.style.cssText);\r\n            console.log('Back button computed styles:', window.getComputedStyle(backBtn));\r\n        }\r\n    },\r\n\r\n    showModal() {\r\n        const modal = document.getElementById('checkoutModal');\r\n        if (modal) {\r\n            modal.classList.add('active');\r\n            modal.removeAttribute('hidden');\r\n\r\n            // Initialize floating labels after modal is shown\r\n            setTimeout(() => {\r\n                this.initFloatingLabels();\r\n            }, 100);\r\n\r\n            // Focus on the first input\r\n            const nameInput = document.getElementById('customerName');\r\n            if (nameInput) {\r\n                nameInput.focus();\r\n            }\r\n        }\r\n    },\r\n\r\n    hideModal() {\r\n        const modal = document.getElementById('checkoutModal');\r\n        if (modal) {\r\n            modal.remove();\r\n        }\r\n    },\r\n\r\n    bindEvents() {\r\n        // Close button\r\n        const closeBtn = document.getElementById('closeCheckoutModal');\r\n        if (closeBtn) {\r\n            closeBtn.addEventListener('click', () => this.close());\r\n        }\r\n\r\n        // Back button\r\n        const backBtn = document.getElementById('backBtn');\r\n        if (backBtn) {\r\n            backBtn.addEventListener('click', () => this.previousStep());\r\n        }\r\n\r\n        // Next button\r\n        const nextBtn = document.getElementById('nextBtn');\r\n        if (nextBtn) {\r\n            nextBtn.addEventListener('click', () => this.nextStep());\r\n        }\r\n\r\n        // Send button\r\n        const sendBtn = document.getElementById('sendBtn');\r\n        if (sendBtn) {\r\n            sendBtn.addEventListener('click', () => this.sendOrder());\r\n        }\r\n\r\n        // Step indicator clicks\r\n        const stepButtons = document.querySelectorAll('.md3-stepper .step');\r\n        stepButtons.forEach((step, index) => {\r\n            step.addEventListener('click', () => {\r\n                const stepNumber = index + 1;\r\n                if (stepNumber <= this.currentStep) {\r\n                    this.showStep(stepNumber);\r\n                }\r\n            });\r\n        });\r\n\r\n        // Close on overlay click\r\n        const modal = document.getElementById('checkoutModal');\r\n        const backdrop = document.querySelector('.md3-modal__backdrop');\r\n        if (modal) {\r\n            modal.addEventListener('click', (e) => {\r\n                if (e.target === modal || e.target === backdrop) {\r\n                    this.close();\r\n                }\r\n            });\r\n        }\r\n        if (backdrop) {\r\n            backdrop.addEventListener('click', () => this.close());\r\n        }\r\n\r\n        // Form submission\r\n        const form = document.getElementById('customerDetailsForm');\r\n        if (form) {\r\n            form.addEventListener('submit', (e) => {\r\n                e.preventDefault();\r\n                this.nextStep();\r\n            });\r\n        }\r\n\r\n        // Phone detection button\r\n        const detectPhoneBtn = document.getElementById('detectPhoneBtn');\r\n        if (detectPhoneBtn) {\r\n            detectPhoneBtn.addEventListener('click', () => this.detectPhoneFromContacts());\r\n        }\r\n\r\n        // Location detection button\r\n        const detectLocationBtn = document.getElementById('detectLocationBtn');\r\n        if (detectLocationBtn) {\r\n            detectLocationBtn.addEventListener('click', () => this.detectLocationFromGPS());\r\n        }\r\n\r\n        // Load saved details if available\r\n        this.loadSavedDetails();\r\n\r\n        // Initialize floating labels\r\n        this.initFloatingLabels();\r\n    },\r\n\r\n    populateOrderSummary() {\r\n        // Get cart data\r\n        const cartItems = window.CartComponent ? window.CartComponent.getItems() : [];\r\n        const subtotal = window.CartComponent ? window.CartComponent.getTotal() : 0;\r\n        const delivery = 500; // Fixed delivery cost\r\n        const total = subtotal + delivery;\r\n\r\n        // Update summary elements\r\n        const summaryName = document.getElementById('summaryName');\r\n        const summaryPhone = document.getElementById('summaryPhone');\r\n        const summaryLocation = document.getElementById('summaryLocation');\r\n        const totalArea = document.getElementById('totalArea');\r\n        const summarySubtotal = document.getElementById('summarySubtotal');\r\n        const summaryDiscount = document.getElementById('summaryDiscount');\r\n        const summaryTotal = document.getElementById('summaryTotal');\r\n\r\n        // Update contact summary (will be populated when user fills form)\r\n        if (summaryName) summaryName.textContent = '';\r\n        if (summaryPhone) summaryPhone.textContent = '';\r\n        if (summaryLocation) summaryLocation.textContent = '';\r\n\r\n        // Update order summary\r\n        if (totalArea) totalArea.textContent = '0 mÂ²'; // Calculate from cart items\r\n        if (summarySubtotal) summarySubtotal.textContent = `KES ${subtotal.toLocaleString()}`;\r\n        if (summaryDiscount) summaryDiscount.textContent = '-KES 0';\r\n        if (summaryTotal) summaryTotal.textContent = `KES ${total.toLocaleString()}`;\r\n\r\n        // Populate order items list\r\n        const orderItemsList = document.getElementById('orderItemsList');\r\n        if (orderItemsList && cartItems.length > 0) {\r\n            orderItemsList.innerHTML = cartItems.map(item => `\r\n                <div class=\"order-item\">\r\n                    <span class=\"item-name\">${item.name}</span>\r\n                    <span class=\"item-quantity\">${item.quantity} units</span>\r\n                    <span class=\"item-price\">KES ${item.price.toLocaleString()}</span>\r\n                </div>\r\n            `).join('');\r\n        }\r\n    },\r\n\r\n    updateOrderSummary() {\r\n        // Get cart total from the global cart state\r\n        let subtotal = 0;\r\n        if (window.CartComponent) {\r\n            subtotal = window.CartComponent.getTotal();\r\n        }\r\n\r\n        const delivery = 500; // Fixed delivery cost\r\n        const total = subtotal + delivery;\r\n\r\n        // Update the summary display\r\n        const subtotalEl = document.getElementById('summarySubtotal');\r\n        const deliveryEl = document.getElementById('summaryDelivery');\r\n        const totalEl = document.getElementById('summaryTotal');\r\n\r\n        if (subtotalEl) subtotalEl.textContent = `KES ${subtotal.toLocaleString()}`;\r\n        if (deliveryEl) deliveryEl.textContent = `KES ${delivery.toLocaleString()}`;\r\n        if (totalEl) totalEl.textContent = `KES ${total.toLocaleString()}`;\r\n    },\r\n\r\n    sendOrder() {\r\n        // Get customer details from step 1\r\n        const name = document.getElementById('customerName') ? document.getElementById('customerName').value : '';\r\n        const phone = document.getElementById('customerPhone') ? document.getElementById('customerPhone').value : '';\r\n        const location = document.getElementById('customerLocation') ? document.getElementById('customerLocation').value : '';\r\n\r\n        // Validate required fields\r\n        if (!name || !phone || !location) {\r\n            this.showError('Please fill in all required fields in step 1');\r\n            this.showStep(1);\r\n            return;\r\n        }\r\n\r\n        // Generate WhatsApp message\r\n        const message = this.generateWhatsAppMessage(name, phone, location);\r\n\r\n        // Open WhatsApp with the message\r\n        const whatsappUrl = `https://wa.me/254743375997?text=${encodeURIComponent(message)}`;\r\n        window.open(whatsappUrl, '_blank');\r\n\r\n        // Show success message\r\n        this.showSuccess('Order sent to WhatsApp! Please complete your order there.');\r\n\r\n        // Close modal after delay\r\n        setTimeout(() => {\r\n            this.close();\r\n        }, 3000);\r\n    },\r\n\r\n    generateWhatsAppMessage(name, phone, location) {\r\n        const cartItems = window.CartComponent ? window.CartComponent.getItems() : [];\r\n        const total = window.CartComponent ? window.CartComponent.getTotal() : 0;\r\n\r\n        let message = `ðŸ  *TURF GRASS ORDER*\\n\\n`;\r\n        message += `*Customer Details:*\\n`;\r\n        message += `Name: ${name}\\n`;\r\n        message += `Phone: +254${phone}\\n`;\r\n        message += `Location: ${location}\\n\\n`;\r\n\r\n        message += `*Order Items:*\\n`;\r\n        cartItems.forEach(item => {\r\n            message += `â€¢ ${item.name} - ${item.quantity} units - KES ${item.price.toLocaleString()}\\n`;\r\n        });\r\n\r\n        message += `\\n*Total: KES ${total.toLocaleString()}*\\n\\n`;\r\n        message += `Please confirm this order and provide delivery details.`;\r\n\r\n        return message;\r\n    },\r\n\r\n    placeOrder() {\r\n        const form = document.getElementById('checkoutForm');\r\n        if (!form) return;\r\n\r\n        const orderData = {\r\n            name: document.getElementById('checkoutName') ? document.getElementById('checkoutName').value : '',\r\n            email: document.getElementById('checkoutEmail') ? document.getElementById('checkoutEmail').value : '',\r\n            phone: document.getElementById('checkoutPhone') ? document.getElementById('checkoutPhone').value : '',\r\n            location: document.getElementById('checkoutLocation') ? document.getElementById('checkoutLocation').value : '',\r\n            address: document.getElementById('checkoutAddress') ? document.getElementById('checkoutAddress').value : '',\r\n            city: document.getElementById('checkoutCity') ? document.getElementById('checkoutCity').value : '',\r\n            saveDetails: document.getElementById('saveDetails') ? document.getElementById('saveDetails').checked : false,\r\n            allowPhoneContact: document.getElementById('allowPhoneContact') ? document.getElementById('allowPhoneContact').checked : false,\r\n            items: window.CartComponent ? window.CartComponent.getItems() : [],\r\n            total: window.CartComponent ? window.CartComponent.getTotal() : 0\r\n        };\r\n\r\n        // Validate required fields\r\n        if (!orderData.name || !orderData.email || !orderData.phone || !orderData.location || !orderData.address || !orderData.city) {\r\n            this.showError('Please fill in all required fields');\r\n            return;\r\n        }\r\n\r\n        // Save details if checkbox is checked\r\n        if (orderData.saveDetails) {\r\n            this.saveDetails();\r\n        }\r\n\r\n        // Here you would typically send the order to your backend\r\n        // For now, we'll just show a success message\r\n        const contactMethod = orderData.allowPhoneContact ? 'phone call' : 'email';\r\n        this.showSuccess(`Order placed successfully! We will contact you via ${contactMethod} soon.`);\r\n\r\n        // Clear cart\r\n        if (window.CartComponent) {\r\n            window.CartComponent.clear();\r\n        }\r\n\r\n        // Close the modal after a short delay\r\n        setTimeout(() => {\r\n            this.close();\r\n        }, 2000);\r\n    },\r\n\r\n    showError(message) {\r\n        // You can implement a toast notification here\r\n        console.error('Checkout Error:', message);\r\n        alert(message);\r\n    },\r\n\r\n    showSuccess(message) {\r\n        // You can implement a toast notification here\r\n        console.log('Checkout Success:', message);\r\n        alert(message);\r\n    },\r\n\r\n    async detectPhoneFromContacts() {\r\n        const detectBtn = document.getElementById('detectPhoneBtn');\r\n        const phoneInput = document.getElementById('customerPhone');\r\n\r\n        if (!detectBtn || !phoneInput) return;\r\n\r\n        // Set loading state\r\n        detectBtn.classList.add('loading');\r\n        detectBtn.innerHTML = '<i class=\"fas fa-spinner\"></i><span>Detecting...</span>';\r\n        detectBtn.disabled = true;\r\n\r\n        try {\r\n            // Check if the Contacts API is available\r\n            if ('contacts' in navigator && 'select' in navigator.contacts) {\r\n                const contacts = await navigator.contacts.select(['name', 'tel'], {\r\n                    multiple: false\r\n                });\r\n\r\n                if (contacts && contacts.length > 0) {\r\n                    const contact = contacts[0];\r\n                    const phoneNumber = contact.tel && contact.tel.length > 0 ? contact.tel[0] : null;\r\n\r\n                    if (phoneNumber) {\r\n                        // Extract just the number part (remove country code if it's +254)\r\n                        let cleanNumber = phoneNumber.replace(/\\D/g, '');\r\n                        if (cleanNumber.startsWith('254')) {\r\n                            cleanNumber = cleanNumber.substring(3);\r\n                        }\r\n\r\n                        phoneInput.value = cleanNumber;\r\n\r\n                        // Set success state\r\n                        detectBtn.classList.remove('loading');\r\n                        detectBtn.classList.add('success');\r\n                        detectBtn.innerHTML = '<i class=\"fas fa-check\"></i><span>Detected</span>';\r\n\r\n                        setTimeout(() => {\r\n                            detectBtn.classList.remove('success');\r\n                            detectBtn.innerHTML = '<i class=\"fas fa-address-book\"></i><span>Detect from Contacts</span>';\r\n                            detectBtn.disabled = false;\r\n                        }, 2000);\r\n\r\n                        this.showSuccess('Phone number detected from contacts!');\r\n                    } else {\r\n                        throw new Error('No phone number found in selected contact');\r\n                    }\r\n                } else {\r\n                    throw new Error('No contact selected');\r\n                }\r\n            } else {\r\n                // Fallback: Show a prompt to manually enter or copy from contacts\r\n                const manualNumber = prompt('Please enter your phone number or copy it from your contacts:');\r\n                if (manualNumber) {\r\n                    phoneInput.value = manualNumber.replace(/\\D/g, '');\r\n                    detectBtn.classList.remove('loading');\r\n                    detectBtn.classList.add('success');\r\n                    detectBtn.innerHTML = '<i class=\"fas fa-check\"></i><span>Entered</span>';\r\n\r\n                    setTimeout(() => {\r\n                        detectBtn.classList.remove('success');\r\n                        detectBtn.innerHTML = '<i class=\"fas fa-address-book\"></i><span>Detect from Contacts</span>';\r\n                        detectBtn.disabled = false;\r\n                    }, 2000);\r\n                } else {\r\n                    throw new Error('No phone number entered');\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error('Error detecting phone:', error);\r\n\r\n            // Set error state\r\n            detectBtn.classList.remove('loading');\r\n            detectBtn.classList.add('error');\r\n            detectBtn.innerHTML = '<i class=\"fas fa-exclamation-triangle\"></i><span>Failed</span>';\r\n\r\n            setTimeout(() => {\r\n                detectBtn.classList.remove('error');\r\n                detectBtn.innerHTML = '<i class=\"fas fa-address-book\"></i><span>Detect from Contacts</span>';\r\n                detectBtn.disabled = false;\r\n            }, 2000);\r\n\r\n            this.showError('Could not detect phone number. Please enter it manually.');\r\n        }\r\n    },\r\n\r\n    async detectLocationFromGPS() {\r\n        const detectBtn = document.getElementById('detectLocationBtn');\r\n        const locationInput = document.getElementById('customerLocation');\r\n\r\n        if (!detectBtn || !locationInput) return;\r\n\r\n        // Set loading state\r\n        detectBtn.classList.add('loading');\r\n        detectBtn.innerHTML = '<i class=\"fas fa-spinner\"></i><span>Detecting...</span>';\r\n        detectBtn.disabled = true;\r\n\r\n        try {\r\n            // Check if geolocation is available\r\n            if ('geolocation' in navigator) {\r\n                const position = await new Promise((resolve, reject) => {\r\n                    navigator.geolocation.getCurrentPosition(resolve, reject, {\r\n                        enableHighAccuracy: true,\r\n                        timeout: 10000,\r\n                        maximumAge: 60000\r\n                    });\r\n                });\r\n\r\n                const {\r\n                    latitude,\r\n                    longitude\r\n                } = position.coords;\r\n\r\n                // Use reverse geocoding to get address\r\n                try {\r\n                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=18&addressdetails=1`);\r\n                    const data = await response.json();\r\n\r\n                    if (data.display_name) {\r\n                        locationInput.value = data.display_name;\r\n\r\n                        // Set success state\r\n                        detectBtn.classList.remove('loading');\r\n                        detectBtn.classList.add('success');\r\n                        detectBtn.innerHTML = '<i class=\"fas fa-check\"></i><span>Detected</span>';\r\n\r\n                        setTimeout(() => {\r\n                            detectBtn.classList.remove('success');\r\n                            detectBtn.innerHTML = '<i class=\"fas fa-map-marker-alt\"></i><span>Use GPS</span>';\r\n                            detectBtn.disabled = false;\r\n                        }, 2000);\r\n\r\n                        this.showSuccess('Location detected from GPS!');\r\n                    } else {\r\n                        // Fallback: Use coordinates\r\n                        locationInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\r\n                        detectBtn.classList.remove('loading');\r\n                        detectBtn.classList.add('success');\r\n                        detectBtn.innerHTML = '<i class=\"fas fa-check\"></i><span>Detected</span>';\r\n\r\n                        setTimeout(() => {\r\n                            detectBtn.classList.remove('success');\r\n                            detectBtn.innerHTML = '<i class=\"fas fa-map-marker-alt\"></i><span>Use GPS</span>';\r\n                            detectBtn.disabled = false;\r\n                        }, 2000);\r\n                    }\r\n                } catch (geocodingError) {\r\n                    // Fallback: Use coordinates if geocoding fails\r\n                    locationInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;\r\n                    detectBtn.classList.remove('loading');\r\n                    detectBtn.classList.add('success');\r\n                    detectBtn.innerHTML = '<i class=\"fas fa-check\"></i><span>Detected</span>';\r\n\r\n                    setTimeout(() => {\r\n                        detectBtn.classList.remove('success');\r\n                        detectBtn.innerHTML = '<i class=\"fas fa-map-marker-alt\"></i><span>Use GPS</span>';\r\n                        detectBtn.disabled = false;\r\n                    }, 2000);\r\n                }\r\n            } else {\r\n                throw new Error('Geolocation not supported');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error detecting location:', error);\r\n\r\n            // Set error state\r\n            detectBtn.classList.remove('loading');\r\n            detectBtn.classList.add('error');\r\n            detectBtn.innerHTML = '<i class=\"fas fa-exclamation-triangle\"></i><span>Failed</span>';\r\n\r\n            setTimeout(() => {\r\n                detectBtn.classList.remove('error');\r\n                detectBtn.innerHTML = '<i class=\"fas fa-map-marker-alt\"></i><span>Use GPS</span>';\r\n                detectBtn.disabled = false;\r\n            }, 2000);\r\n\r\n            this.showError('Could not detect location. Please enter it manually.');\r\n        }\r\n    },\r\n\r\n    loadSavedDetails() {\r\n        try {\r\n            const savedDetails = localStorage.getItem('checkoutDetails');\r\n            if (savedDetails) {\r\n                const details = JSON.parse(savedDetails);\r\n\r\n                if (details.name) {\r\n                    const nameInput = document.getElementById('customerName');\r\n                    if (nameInput) nameInput.value = details.name;\r\n                }\r\n                if (details.phone) {\r\n                    const phoneInput = document.getElementById('customerPhone');\r\n                    if (phoneInput) phoneInput.value = details.phone;\r\n                }\r\n                if (details.email) {\r\n                    const emailInput = document.getElementById('customerEmail');\r\n                    if (emailInput) emailInput.value = details.email;\r\n                }\r\n                if (details.location) {\r\n                    const locationInput = document.getElementById('customerLocation');\r\n                    if (locationInput) locationInput.value = details.location;\r\n                }\r\n\r\n                // Check the remember details checkbox if we loaded saved data\r\n                const rememberDetailsCheckbox = document.getElementById('rememberDetails');\r\n                if (rememberDetailsCheckbox) {\r\n                    rememberDetailsCheckbox.checked = true;\r\n                }\r\n\r\n                // Update floating labels for loaded values\r\n                setTimeout(() => {\r\n                    this.initFloatingLabels();\r\n                }, 50);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error loading saved details:', error);\r\n        }\r\n    },\r\n\r\n    saveDetails() {\r\n        const rememberDetailsCheckbox = document.getElementById('rememberDetails');\r\n        if (rememberDetailsCheckbox && rememberDetailsCheckbox.checked) {\r\n            try {\r\n                const details = {\r\n                    name: document.getElementById('customerName') ? document.getElementById('customerName').value : '',\r\n                    phone: document.getElementById('customerPhone') ? document.getElementById('customerPhone').value : '',\r\n                    email: document.getElementById('customerEmail') ? document.getElementById('customerEmail').value : '',\r\n                    location: document.getElementById('customerLocation') ? document.getElementById('customerLocation').value : ''\r\n                };\r\n\r\n                localStorage.setItem('checkoutDetails', JSON.stringify(details));\r\n                console.log('Details saved to localStorage');\r\n            } catch (error) {\r\n                console.error('Error saving details:', error);\r\n            }\r\n        }\r\n    },\r\n\r\n    // Step navigation methods\r\n    showStep(stepNumber) {\r\n        console.log('showStep called with stepNumber:', stepNumber);\r\n\r\n        // Hide all steps\r\n        const steps = document.querySelectorAll('.checkout-step');\r\n        steps.forEach(step => step.classList.remove('active'));\r\n\r\n        // Show current step\r\n        const currentStep = document.getElementById(`step${stepNumber}`);\r\n        if (currentStep) {\r\n            currentStep.classList.add('active');\r\n        }\r\n\r\n        this.currentStep = stepNumber;\r\n        console.log('Current step updated to:', this.currentStep);\r\n\r\n        this.updateStepIndicator();\r\n        this.updateButtonStates();\r\n\r\n        // Populate summary data when moving to step 2\r\n        if (stepNumber === 2) {\r\n            this.populateSummaryData();\r\n        }\r\n\r\n        // Populate message preview when moving to step 3\r\n        if (stepNumber === 3) {\r\n            this.populateMessagePreview();\r\n        }\r\n    },\r\n\r\n    populateSummaryData() {\r\n        // Get form data\r\n        const name = document.getElementById('customerName') ? document.getElementById('customerName').value : '';\r\n        const phone = document.getElementById('customerPhone') ? document.getElementById('customerPhone').value : '';\r\n        const location = document.getElementById('customerLocation') ? document.getElementById('customerLocation').value : '';\r\n\r\n        // Update summary elements\r\n        const summaryName = document.getElementById('summaryName');\r\n        const summaryPhone = document.getElementById('summaryPhone');\r\n        const summaryLocation = document.getElementById('summaryLocation');\r\n\r\n        if (summaryName) summaryName.textContent = name || 'Not provided';\r\n        if (summaryPhone) summaryPhone.textContent = phone ? `+254${phone}` : 'Not provided';\r\n        if (summaryLocation) summaryLocation.textContent = location || 'Not provided';\r\n    },\r\n\r\n    populateMessagePreview() {\r\n        // Get customer details\r\n        const name = document.getElementById('customerName') ? document.getElementById('customerName').value : '';\r\n        const phone = document.getElementById('customerPhone') ? document.getElementById('customerPhone').value : '';\r\n        const location = document.getElementById('customerLocation') ? document.getElementById('customerLocation').value : '';\r\n\r\n        // Generate message\r\n        const message = this.generateWhatsAppMessage(name, phone, location);\r\n\r\n        // Update message preview\r\n        const messagePreview = document.getElementById('messagePreview');\r\n        if (messagePreview) {\r\n            messagePreview.textContent = message;\r\n        }\r\n    },\r\n\r\n    nextStep() {\r\n        if (this.currentStep < this.totalSteps) {\r\n            this.showStep(this.currentStep + 1);\r\n        }\r\n    },\r\n\r\n    previousStep() {\r\n        if (this.currentStep > 1) {\r\n            this.showStep(this.currentStep - 1);\r\n        }\r\n    },\r\n\r\n    updateStepIndicator() {\r\n        const steps = document.querySelectorAll('.md3-stepper .step');\r\n        const rails = document.querySelectorAll('.md3-stepper .rail');\r\n\r\n        console.log('Updating step indicator. Current step:', this.currentStep);\r\n        console.log('Found steps:', steps.length, 'Found rails:', rails.length);\r\n\r\n        steps.forEach((step, index) => {\r\n            const stepNumber = index + 1;\r\n            step.classList.remove('is-active', 'completed');\r\n\r\n            if (stepNumber === this.currentStep) {\r\n                step.classList.add('is-active');\r\n                console.log(`Step ${stepNumber} is now active`);\r\n            } else if (stepNumber < this.currentStep) {\r\n                step.classList.add('completed');\r\n                console.log(`Step ${stepNumber} is now completed`);\r\n            }\r\n        });\r\n\r\n        // Update rail filling\r\n        rails.forEach((rail, index) => {\r\n            rail.classList.remove('completed', 'active');\r\n            console.log(`Rail ${index + 1} classes removed`);\r\n\r\n            if (index < this.currentStep - 1) {\r\n                // Rail is fully completed\r\n                rail.classList.add('completed');\r\n                console.log(`Rail ${index + 1} is now completed`);\r\n            } else if (index === this.currentStep - 1) {\r\n                // Rail is partially filled (current step)\r\n                rail.classList.add('active');\r\n                console.log(`Rail ${index + 1} is now active (50% filled)`);\r\n            }\r\n        });\r\n    },\r\n\r\n    updateButtonStates() {\r\n        const backBtn = document.getElementById('backBtn');\r\n        const nextBtn = document.getElementById('nextBtn');\r\n        const sendBtn = document.getElementById('sendBtn');\r\n\r\n        // Debug logging\r\n        console.log('updateButtonStates called, currentStep:', this.currentStep);\r\n        console.log('backBtn found:', !!backBtn);\r\n\r\n        // Show/hide back button (now in header)\r\n        if (backBtn) {\r\n            // Always show back button - it can close the modal\r\n            backBtn.style.display = 'grid';\r\n            console.log('Back button should be visible');\r\n        } else {\r\n            console.log('Back button not found in DOM');\r\n        }\r\n\r\n        // Update next button text\r\n        if (nextBtn) {\r\n            if (this.currentStep === 1) {\r\n                nextBtn.innerHTML = 'Review Order <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M5 12h14M13 5l7 7-7 7\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>';\r\n            } else if (this.currentStep === 2) {\r\n                nextBtn.innerHTML = 'Send Order <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M5 12h14M13 5l7 7-7 7\" fill=\"none\" stroke=\"#fff\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>';\r\n            }\r\n        }\r\n\r\n        // Show/hide send button\r\n        if (sendBtn) {\r\n            if (this.currentStep === 3) {\r\n                sendBtn.style.display = 'inline-flex';\r\n                if (nextBtn) nextBtn.style.display = 'none';\r\n            } else {\r\n                sendBtn.style.display = 'none';\r\n                if (nextBtn) nextBtn.style.display = 'inline-flex';\r\n            }\r\n        }\r\n    },\r\n\r\n    initFloatingLabels() {\r\n        // Get all Material Design 3 input fields\r\n        const inputs = document.querySelectorAll('.md3-field input');\r\n\r\n        console.log('Initializing floating labels for', inputs.length, 'inputs');\r\n\r\n        inputs.forEach((input, index) => {\r\n            // Ensure placeholder is set to a single space for proper floating label behavior\r\n            if (!input.placeholder || input.placeholder === '') {\r\n                input.placeholder = ' ';\r\n            }\r\n\r\n            // Remove existing event listeners to prevent duplicates\r\n            input.removeEventListener('input', this.updateFloatingLabel.bind(this, input));\r\n            input.removeEventListener('focus', this.updateFloatingLabel.bind(this, input));\r\n            input.removeEventListener('blur', this.updateFloatingLabel.bind(this, input));\r\n\r\n            // Add event listeners for proper floating label behavior\r\n            input.addEventListener('input', () => {\r\n                this.updateFloatingLabel(input);\r\n            });\r\n\r\n            input.addEventListener('focus', () => {\r\n                this.updateFloatingLabel(input);\r\n            });\r\n\r\n            input.addEventListener('blur', () => {\r\n                this.updateFloatingLabel(input);\r\n            });\r\n\r\n            // Initialize floating label state\r\n            this.updateFloatingLabel(input);\r\n\r\n            console.log(`Input ${index + 1}:`, input.id || input.name, 'initialized');\r\n        });\r\n    },\r\n\r\n    updateFloatingLabel(input) {\r\n        const label = input.parentElement.querySelector('.md3-label');\r\n        if (!label) {\r\n            console.warn('No label found for input:', input.id || input.name);\r\n            return;\r\n        }\r\n\r\n        const hasValue = input.value.trim().length > 0;\r\n        const isFocused = document.activeElement === input;\r\n\r\n        // Update input classes\r\n        if (hasValue) {\r\n            input.classList.add('has-value');\r\n        } else {\r\n            input.classList.remove('has-value');\r\n        }\r\n\r\n        // Update label classes\r\n        if (hasValue || isFocused) {\r\n            label.classList.add('floating');\r\n        } else {\r\n            label.classList.remove('floating');\r\n        }\r\n\r\n        // Hide placeholder when input has value or is focused\r\n        if (hasValue || isFocused) {\r\n            input.style.setProperty('--placeholder-opacity', '0');\r\n        } else {\r\n            input.style.removeProperty('--placeholder-opacity');\r\n        }\r\n\r\n        console.log(`Updated floating label for ${input.id || input.name}:`, {\r\n            hasValue,\r\n            isFocused,\r\n            hasValueClass: input.classList.contains('has-value'),\r\n            hasFloatingClass: label.classList.contains('floating')\r\n        });\r\n    }\r\n};"],"names":["checkoutModal","existingModal","response","modalHTML","error","backBtn","modal","nameInput","closeBtn","nextBtn","sendBtn","step","index","stepNumber","backdrop","e","form","detectPhoneBtn","detectLocationBtn","cartItems","subtotal","total","summaryName","summaryPhone","summaryLocation","totalArea","summarySubtotal","summaryDiscount","summaryTotal","orderItemsList","item","delivery","subtotalEl","deliveryEl","totalEl","name","phone","location","message","whatsappUrl","orderData","contactMethod","detectBtn","phoneInput","contacts","contact","phoneNumber","cleanNumber","manualNumber","locationInput","position","resolve","reject","latitude","longitude","data","savedDetails","details","emailInput","rememberDetailsCheckbox","currentStep","messagePreview","steps","rails","rail","inputs","input","label","hasValue","isFocused"],"mappings":"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"}