var e=(e,t,n)=>new Promise((r,o)=>{var a=e=>{try{d(n.next(e))}catch(t){o(t)}},i=e=>{try{d(n.throw(e))}catch(t){o(t)}},d=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,i);d((n=n.apply(e,t)).next())});(()=>{let t=[],n=[],r=1;function o(e,t="success"){var n;"function"==typeof window.showToast?window.showToast(e,t):(null==(n=window.BrokerDashboard)?void 0:n.showToast)?window.BrokerDashboard.showToast(e,t):console.log("[".concat(t.toUpperCase(),"] ").concat(e))}function a(){return e(this,null,function*(){yield function(){return e(this,null,function*(){try{const e=yield fetch("/data/products.json");if(!e.ok)throw new Error("HTTP ".concat(e.status));t=yield e.json()}catch(e){console.error("Failed to load products:",e),o("Failed to load products","error"),t=[]}})}(),u()})}function i(){var e;const t={id:r++,productId:"",product:null,quantity:1,unitPrice:0,total:0,expectedDate:"",specialNotes:""};n.push(t),u(),o("Preorder item added","success"),(null==(e=window.BrokerDashboard)?void 0:e.updateCartCount)&&window.BrokerDashboard.updateCartCount(p())}function d(e){var t;n=n.filter(t=>t.id!==e),u(),o("Preorder item removed","success"),(null==(t=window.BrokerDashboard)?void 0:t.updateCartCount)&&window.BrokerDashboard.updateCartCount(p())}function c(e,r,o){var a,i,d,c;const l=n.find(t=>t.id===e);if(l){if("productId"===r){const e=t.find(e=>String(e.id)===String(o));l.productId=o,l.product=e||null,l.unitPrice=e&&Number(e.price)||0,l.total=l.unitPrice*(Number(l.quantity)||0)}else if("quantity"===r){const e=null!=(c=null!=(d=null==(i=null==(a=window.numberFormatter)?void 0:a.parseFormattedNumber)?void 0:i.call(a,o))?d:parseFloat(String(o)))?c:0;l.quantity=isNaN(e)?0:e,l.total=l.unitPrice*l.quantity}else"expectedDate"===r?l.expectedDate=o:"specialNotes"===r&&(l.specialNotes=o);u()}}function l(){return n.reduce((e,t)=>e+(Number(t.total)||0),0)}function u(){const e=document.getElementById("preorderTableBody"),r=document.getElementById("emptyPreorderState"),o=document.getElementById("preorderTotal"),a=document.getElementById("submitPreordersBtn");if(!(e&&r&&o&&a))return;0===n.length?(e.innerHTML="",r.style.display="block",a.disabled=!0):(r.style.display="none",a.disabled=!1,e.innerHTML=n.map(e=>function(e){const n=t.map(t=>'\n          <option value="'.concat(t.id,'" ').concat(String(e.productId)===String(t.id)?"selected":"",">\n            ").concat(t.name," (").concat(t.thickness,")\n          </option>")).join("");return'\n      <tr>\n        <td>\n          <div class="order-field">\n            <label for="preorder-product-'.concat(e.id,'">Product Name</label>\n            <select class="table-select" id="preorder-product-').concat(e.id,'">\n              <option value="">Select a product</option>\n              ').concat(n,'\n            </select>\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label for="preorder-quantity-').concat(e.id,'">Quantity (m²)</label>\n            <input type="number" inputmode="decimal" class="table-input" id="preorder-quantity-').concat(e.id,'"\n                   value="').concat(e.quantity,'" min="0.1" step="0.1" placeholder="0">\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label>Unit Price (KES)</label>\n            <input type="text" class="table-input" readonly value="').concat(Number(e.unitPrice).toLocaleString("en-US"),'">\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label for="preorder-date-').concat(e.id,'">Expected Date</label>\n            <input type="date" class="table-input" id="preorder-date-').concat(e.id,'"\n                   value="').concat(e.expectedDate||"",'" placeholder="Expected date">\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label for="preorder-notes-').concat(e.id,'">Special Notes</label>\n            <input type="text" class="table-input" id="preorder-notes-').concat(e.id,'"\n                   value="').concat(e.specialNotes||"",'" placeholder="Special notes">\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label>Total (KES)</label>\n            <strong>').concat(Number(e.total).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),'</strong>\n          </div>\n        </td>\n        <td>\n          <div class="order-field">\n            <label>Action</label>\n            <button class="delete-btn" id="delete-preorder-').concat(e.id,'">\n              <i class="fas fa-trash"></i> Delete\n            </button>\n          </div>\n        </td>\n      </tr>')}(e)).join(""),n.forEach(e=>{var t;const n=document.getElementById("preorder-product-".concat(e.id)),r=document.getElementById("preorder-quantity-".concat(e.id)),o=document.getElementById("preorder-date-".concat(e.id)),a=document.getElementById("preorder-notes-".concat(e.id)),i=document.getElementById("delete-preorder-".concat(e.id));if(null==n||n.addEventListener("change",t=>c(e.id,"productId",t.target.value)),r)if(r.addEventListener("input",t=>c(e.id,"quantity",t.target.value)),null==(t=window.numberFormatter)?void 0:t.initInputFormatting)window.numberFormatter.initInputFormatting(r,{allowDecimals:!0,decimalPlaces:1,currency:"KES"});else{const e=setInterval(()=>{var t;(null==(t=window.numberFormatter)?void 0:t.initInputFormatting)&&(window.numberFormatter.initInputFormatting(r,{allowDecimals:!0,decimalPlaces:1,currency:"KES"}),clearInterval(e))},100)}null==o||o.addEventListener("change",t=>c(e.id,"expectedDate",t.target.value)),null==a||a.addEventListener("input",t=>c(e.id,"specialNotes",t.target.value)),null==i||i.addEventListener("click",()=>d(e.id))}));const i=l();o.textContent=Number(i).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function s(){return e(this,null,function*(){var e,t,a,i;if(0===n.length)return void o("No preorder items to submit","error");if(n.filter(e=>!e.productId||Number(e.quantity)<=0).length>0)o("Please complete all preorder items before submitting","error");else try{const d={brokerName:"Broker User",brokerEmail:"broker@eastleighturf.com",items:n.map(e=>({product:e.product,quantity:e.quantity,unitPrice:e.unitPrice,total:e.total})),expectedDate:(null==(e=n[0])?void 0:e.expectedDate)||"Not specified",specialNotes:(null==(t=n[0])?void 0:t.specialNotes)||"None",total:l()};let c=!1;if(null==(a=window.WhatsAppService)?void 0:a.sendPreorderForm){const e=window.WhatsAppService.sendPreorderForm(d);c="function"==typeof(null==e?void 0:e.then)?yield e:!!e}else{const e=function(e){const{brokerName:t,brokerEmail:n,items:r,expectedDate:o,specialNotes:a,total:i}=e,d=r.map(e=>{var t,n,r,o;const a=null!=(n=null==(t=e.product)?void 0:t.name)?n:"Unknown",i=null!=(o=null==(r=e.product)?void 0:r.thickness)?o:"";return"• ".concat(a," (").concat(i,")\n  Quantity: ").concat(e.quantity," m²\n  Unit Price: KES ").concat(Number(e.unitPrice).toLocaleString(),"\n  Total: KES ").concat(Number(e.total).toLocaleString())}).join("\n\n");return"*BROKER PREORDER SUBMISSION - Eastleigh Turf Grass*\n\n*Broker Details:*\n• Name: ".concat(t,"\n• Email: ").concat(n,"\n\n*Preorder Items:*\n").concat(d,"\n\n*Preorder Details:*\n• Expected Date: ").concat(o||"Not specified","\n• Special Notes: ").concat(a||"None","\n• Total Amount: KES ").concat(Number(i).toLocaleString(),"\n\n*Submitted:* ").concat((new Date).toLocaleString("en-KE"))}(d),t="254743375997",n=encodeURIComponent(e),r="https://wa.me/".concat(t,"?text=").concat(n);window.open(r,"_blank"),c=!0}c?(o("Preorders submitted successfully! WhatsApp will open with your preorder details.","success"),n=[],r=1,u(),(null==(i=window.BrokerDashboard)?void 0:i.updateCartCount)&&window.BrokerDashboard.updateCartCount(p())):o("Failed to send preorders. Please try again.","error")}catch(d){console.error("Preorder submission error:",d),o("An error occurred while submitting the preorders.","error")}})}function p(){return n.length}function m(){var e,t;null==(e=document.getElementById("addPreorderBtn"))||e.addEventListener("click",i),null==(t=document.getElementById("submitPreordersBtn"))||t.addEventListener("click",s)}window.PreordersModule={init:a,addPreorder:i,removePreorder:d,updatePreorder:c,submitPreorders:s,getItemCount:p},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{a(),m()}):(a(),m())})();
//# sourceMappingURL=preorders.a819c41b.js.map
