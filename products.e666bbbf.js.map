{"version":3,"mappings":"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","names":["Cart","items","appliedCoupon","appliedPromotion","subscribers","getItems","add","item","id","render","remove","it","clear","getSubtotal","sum","applyCoupon","code","subtotal","result","couponService","applyPromotion","promotionId","discountService","removeDiscount","getDiscountAmount","discountAmount","getTotal","getAvailablePromotions","getBestPromotion","total","callback","e","subscribe","index","createProductCard","product","onAddToCart","fmt","n","el","u","f","widthInput","heightInput","calcBtn","resultDiv","addToCartBtn","calculationTimeout","validateInputs","w","h","performCalculation","width","height","isValid","area","debouncedCalculation","resetCardInputs","value","cartItem","__vitePreload","module","err","grid","res","products","card","cartSection"],"sources":["../src/state/cartState.js.js","../src/ui/components/productCard.js","../src/js/pages/products.js"],"sourcesContent":["// js/state/cartState.js — Central cart state management\r\nimport {\r\n    couponService\r\n} from '../services/couponService.js';\r\nimport {\r\n    discountService\r\n} from '../services/discountService.js';\r\n\r\nconst Cart = (() => {\r\n    let items = []; // Array of { id, product, width, height, area, total }\r\n    let appliedCoupon = null;\r\n    let appliedPromotion = null;\r\n    let subscribers = [];\r\n\r\n    function getItems() {\r\n        return [...items]; // return a shallow copy\r\n    }\r\n\r\n    function add(item) {\r\n        const id = Date.now();\r\n        items.push({\r\n            id,\r\n            ...item\r\n        });\r\n        render();\r\n    }\r\n\r\n    function remove(id) {\r\n        items = items.filter(it => it.id !== id);\r\n        render();\r\n    }\r\n\r\n    function clear() {\r\n        items = [];\r\n        appliedCoupon = null;\r\n        appliedPromotion = null;\r\n        render();\r\n    }\r\n\r\n    function getSubtotal() {\r\n        return items.reduce((sum, it) => sum + it.total, 0);\r\n    }\r\n\r\n    function applyCoupon(code) {\r\n        const subtotal = getSubtotal();\r\n        const result = couponService.applyCoupon(code, subtotal);\r\n\r\n        if (result.valid) {\r\n            appliedCoupon = result.coupon;\r\n            appliedPromotion = null; // Remove any applied promotion\r\n            couponService.incrementCouponUsage(code);\r\n        }\r\n\r\n        render();\r\n        return result;\r\n    }\r\n\r\n    function applyPromotion(promotionId) {\r\n        const subtotal = getSubtotal();\r\n        const result = discountService.applyPromotion(promotionId, subtotal);\r\n\r\n        if (result.valid) {\r\n            appliedPromotion = result.promotion;\r\n            appliedCoupon = null; // Remove any applied coupon\r\n        }\r\n\r\n        render();\r\n        return result;\r\n    }\r\n\r\n    function removeDiscount() {\r\n        appliedCoupon = null;\r\n        appliedPromotion = null;\r\n        render();\r\n    }\r\n\r\n    function getDiscountAmount() {\r\n        const subtotal = getSubtotal();\r\n        let discountAmount = 0;\r\n\r\n        if (appliedCoupon) {\r\n            discountAmount = couponService.calculateCouponDiscount(appliedCoupon, subtotal);\r\n        } else if (appliedPromotion) {\r\n            discountAmount = discountService.calculatePromotionDiscount(appliedPromotion, subtotal);\r\n        }\r\n\r\n        return discountAmount;\r\n    }\r\n\r\n    function getTotal() {\r\n        const subtotal = getSubtotal();\r\n        const discountAmount = getDiscountAmount();\r\n        return subtotal - discountAmount;\r\n    }\r\n\r\n    function getAvailablePromotions() {\r\n        const subtotal = getSubtotal();\r\n        return discountService.getAvailablePromotions(subtotal);\r\n    }\r\n\r\n    function getBestPromotion() {\r\n        const subtotal = getSubtotal();\r\n        return discountService.getBestPromotion(subtotal);\r\n    }\r\n\r\n    function render() {\r\n        const subtotal = getSubtotal();\r\n        const discountAmount = getDiscountAmount();\r\n        const total = getTotal();\r\n\r\n        // Notify all subscribers\r\n        subscribers.forEach(callback => {\r\n            try {\r\n                callback({\r\n                    items: getItems(),\r\n                    subtotal: subtotal,\r\n                    discountAmount: discountAmount,\r\n                    total: total,\r\n                    appliedCoupon: appliedCoupon,\r\n                    appliedPromotion: appliedPromotion\r\n                });\r\n            } catch (e) {\r\n                console.error('Cart subscriber error:', e);\r\n            }\r\n        });\r\n\r\n        // Optional: trigger UI updates\r\n        if (window.renderCartUI) {\r\n            window.renderCartUI(getItems(), total, discountAmount);\r\n        }\r\n    }\r\n\r\n    function subscribe(callback) {\r\n        subscribers.push(callback);\r\n        // Return unsubscribe function\r\n        return () => {\r\n            const index = subscribers.indexOf(callback);\r\n            if (index > -1) {\r\n                subscribers.splice(index, 1);\r\n            }\r\n        };\r\n    }\r\n\r\n    return {\r\n        getItems,\r\n        add,\r\n        remove,\r\n        clear,\r\n        getSubtotal,\r\n        applyCoupon,\r\n        applyPromotion,\r\n        removeDiscount,\r\n        getDiscountAmount,\r\n        getTotal,\r\n        getAvailablePromotions,\r\n        getBestPromotion,\r\n        subscribe\r\n    };\r\n})();\r\n\r\nexport {\r\n    Cart\r\n};","// ui/productCard.js\r\nexport function createProductCard(product, onAddToCart) {\r\n    const fmt = (n) => Number.isFinite(n) ? n.toLocaleString() : '0';\r\n\r\n    const el = document.createElement('div');\r\n    el.className = 'product-card';\r\n    el.setAttribute('data-product-id', product.id);\r\n\r\n    el.innerHTML = `\r\n    <div class=\"product-image\">\r\n      <img src=\"${product.image}\" alt=\"${product.name}\" />\r\n      <div class=\"product-badges\">\r\n        <div class=\"product-badge\">${product.thickness}</div>\r\n        <div class=\"product-badge price\">\r\n          KES <span class=\"price-amount\">${fmt(product.price)}</span>/m²\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"product-content\">\r\n      <h3 class=\"product-title\">${product.name}</h3>\r\n\r\n      <div class=\"product-section\">\r\n        <h4>Best for</h4>\r\n        <div class=\"use-cases\">\r\n          ${product.useCases.map((u) => `<span class=\"use-case\">${u}</span>`).join('')}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"product-section\">\r\n        <h4>Key Features:</h4>\r\n        <ul class=\"features-list\">\r\n          ${product.features.map((f) => `<li>${f}</li>`).join('')}\r\n        </ul>\r\n      </div>\r\n\r\n      <div class=\"calculator-section\">\r\n        <div class=\"dimension-inputs\">\r\n          <div class=\"input-group\">\r\n            <label>Width (m)</label>\r\n            <input type=\"number\" class=\"width-input\" placeholder=\"0\" min=\"0\" step=\"0.1\" inputmode=\"decimal\" pattern=\"[0-9]*[.]?[0-9]+\" />\r\n          </div>\r\n          <div class=\"input-group\">\r\n            <label>Height (m)</label>\r\n            <input type=\"number\" class=\"height-input\" placeholder=\"0\" min=\"0\" step=\"0.1\" inputmode=\"decimal\" pattern=\"[0-9]*[.]?[0-9]+\" />\r\n          </div>\r\n        </div>\r\n\r\n        <button class=\"calculate-btn\">\r\n          <i class=\"fas fa-calculator\"></i>\r\n          Calculate\r\n        </button>\r\n\r\n        <div class=\"calculation-result\" style=\"display:none;\">\r\n          <div class=\"result-row\">\r\n            <span class=\"area-label\">Area:</span><span class=\"area-value\">0 m²</span>\r\n          </div>\r\n          <div class=\"result-row\">\r\n            <span class=\"unit-price-label\">Unit Price:</span><span class=\"unit-price\">KES 0/m²</span>\r\n          </div>\r\n          <div class=\"result-row\">\r\n            <span class=\"total-label\">Total:</span><span class=\"total-price\">KES 0</span>\r\n          </div>\r\n        </div>\r\n\r\n        <button class=\"add-to-cart-btn\" disabled>\r\n          <i class=\"fas fa-shopping-cart\"></i>\r\n          Add to Cart\r\n        </button>\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n    // Wire calculator\r\n    const widthInput = el.querySelector('.width-input');\r\n    const heightInput = el.querySelector('.height-input');\r\n    const calcBtn = el.querySelector('.calculate-btn');\r\n    const resultDiv = el.querySelector('.calculation-result');\r\n    const addToCartBtn = el.querySelector('.add-to-cart-btn');\r\n\r\n    // Auto-calculation and validation functions\r\n    let calculationTimeout = null;\r\n\r\n    const validateInputs = () => {\r\n        const w = parseFloat(widthInput.value) || 0;\r\n        const h = parseFloat(heightInput.value) || 0;\r\n\r\n        // Clear previous validation states\r\n        widthInput.classList.remove('input-valid', 'input-invalid');\r\n        heightInput.classList.remove('input-valid', 'input-invalid');\r\n\r\n        if (w > 0 && h > 0) {\r\n            widthInput.classList.add('input-valid');\r\n            heightInput.classList.add('input-valid');\r\n            return {\r\n                width: w,\r\n                height: h,\r\n                isValid: true\r\n            };\r\n        } else {\r\n            if (w <= 0 && widthInput.value !== '') {\r\n                widthInput.classList.add('input-invalid');\r\n            }\r\n            if (h <= 0 && heightInput.value !== '') {\r\n                heightInput.classList.add('input-invalid');\r\n            }\r\n            return {\r\n                width: w,\r\n                height: h,\r\n                isValid: false\r\n            };\r\n        }\r\n    };\r\n\r\n    const performCalculation = () => {\r\n        const {\r\n            width,\r\n            height,\r\n            isValid\r\n        } = validateInputs();\r\n\r\n        if (isValid) {\r\n            const area = width * height;\r\n            const total = area * product.price;\r\n\r\n            el.querySelector('.area-value').textContent = `${area.toFixed(2)} m²`;\r\n            el.querySelector('.unit-price').textContent = `KES ${fmt(product.price)}/m²`;\r\n            el.querySelector('.total-price').textContent = `KES ${fmt(total)}`;\r\n\r\n            resultDiv.style.display = 'block';\r\n            addToCartBtn.disabled = false;\r\n\r\n            addToCartBtn.dataset.width = String(width);\r\n            addToCartBtn.dataset.height = String(height);\r\n            addToCartBtn.dataset.area = String(area);\r\n            addToCartBtn.dataset.total = String(total);\r\n        } else {\r\n            resultDiv.style.display = 'none';\r\n            addToCartBtn.disabled = true;\r\n        }\r\n    };\r\n\r\n    const debouncedCalculation = () => {\r\n        if (calculationTimeout) {\r\n            clearTimeout(calculationTimeout);\r\n        }\r\n        calculationTimeout = setTimeout(performCalculation, 300);\r\n    };\r\n\r\n    const resetCardInputs = () => {\r\n        // Clear inputs\r\n        widthInput.value = '';\r\n        heightInput.value = '';\r\n\r\n        // Clear validation states\r\n        widthInput.classList.remove('input-valid', 'input-invalid');\r\n        heightInput.classList.remove('input-valid', 'input-invalid');\r\n\r\n        // Hide results\r\n        resultDiv.style.display = 'none';\r\n        addToCartBtn.disabled = true;\r\n\r\n        // Clear data attributes\r\n        delete addToCartBtn.dataset.width;\r\n        delete addToCartBtn.dataset.height;\r\n        delete addToCartBtn.dataset.area;\r\n        delete addToCartBtn.dataset.total;\r\n\r\n        // Focus back to width input for next calculation\r\n        setTimeout(() => {\r\n            widthInput.focus();\r\n        }, 100);\r\n    };\r\n\r\n    // Auto-calculation on blur\r\n    widthInput.addEventListener('blur', debouncedCalculation);\r\n    heightInput.addEventListener('blur', debouncedCalculation);\r\n\r\n    // Real-time validation on input\r\n    widthInput.addEventListener('input', (e) => {\r\n        // Ensure only numbers and decimal points are allowed\r\n        const value = e.target.value;\r\n        if (value && !/^\\d*\\.?\\d*$/.test(value)) {\r\n            e.target.value = value.replace(/[^\\d.]/g, '');\r\n        }\r\n        validateInputs();\r\n    });\r\n\r\n    heightInput.addEventListener('input', (e) => {\r\n        // Ensure only numbers and decimal points are allowed\r\n        const value = e.target.value;\r\n        if (value && !/^\\d*\\.?\\d*$/.test(value)) {\r\n            e.target.value = value.replace(/[^\\d.]/g, '');\r\n        }\r\n        validateInputs();\r\n    });\r\n\r\n    // Manual calculation button (fallback)\r\n    calcBtn.addEventListener('click', performCalculation);\r\n\r\n    // Keyboard shortcuts\r\n    el.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Enter' && (e.target === widthInput || e.target === heightInput)) {\r\n            e.preventDefault();\r\n            performCalculation();\r\n        } else if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            resetCardInputs();\r\n        }\r\n    });\r\n\r\n    addToCartBtn.addEventListener('click', () => {\r\n        const width = parseFloat(addToCartBtn.dataset.width || '0');\r\n        const height = parseFloat(addToCartBtn.dataset.height || '0');\r\n        const area = parseFloat(addToCartBtn.dataset.area || '0');\r\n        const total = parseFloat(addToCartBtn.dataset.total || '0');\r\n\r\n        const cartItem = {\r\n            id: product.id,\r\n            name: product.name,\r\n            image: product.image,\r\n            price: product.price,\r\n            length: height, // height becomes length\r\n            width: width,\r\n            area: area,\r\n            total: total,\r\n            quantity: 1\r\n        };\r\n\r\n        // Use the cart component system\r\n        if (window.CartComponent) {\r\n            window.CartComponent.add(cartItem);\r\n        }\r\n\r\n        // Also call the callback for backward compatibility\r\n        if (typeof onAddToCart === 'function') {\r\n            onAddToCart(cartItem);\r\n        }\r\n\r\n        // Auto-reset after successful add to cart\r\n        setTimeout(() => {\r\n            resetCardInputs();\r\n        }, 200);\r\n    });\r\n\r\n    return el;\r\n}","import {\r\n    Cart\r\n} from '../../state/cartState.js';\r\nimport {\r\n    createProductCard\r\n} from '../../ui/components/productCard.js';\r\nimport '../components/header.js';\r\nimport '../components/cart.js';\r\nimport '../components/toast.js';\r\nimport '../../css/header.css';\r\nimport '../../css/toast.css';\r\nimport '../../css/products.css';\r\nimport '../../services/toastService.js';\r\n\r\n// Make Cart state available globally for discount functionality\r\nwindow.CartState = Cart;\r\n\r\n// Ensure all modals are available on products page (optional - don't block if they fail)\r\nPromise.allSettled([\r\n    import('../../ui/checkoutModal.js').then(module => {\r\n        window.checkoutModal = module.checkoutModal;\r\n        console.log('Checkout modal loaded');\r\n    }).catch(err => console.warn('Checkout modal not available:', err)),\r\n    import('../../ui/discountModal.js').then(module => {\r\n        window.discountModal = module.discountModal;\r\n        console.log('Discount modal loaded');\r\n    }).catch(err => console.warn('Discount modal not available:', err)),\r\n    import('../../ui/components/couponModal.js').then(module => {\r\n        window.couponModal = module.couponModal;\r\n        console.log('Coupon modal loaded');\r\n    }).catch(err => console.warn('Coupon modal not available:', err)),\r\n    import('../../ui/BrokerLoginModal.js').then(() => {\r\n        console.log('Broker login modal loaded');\r\n    }).catch(err => console.warn('Broker login modal not available:', err))\r\n]);\r\n\r\n// Products Page Controller\r\n(() => {\r\n    document.addEventListener('DOMContentLoaded', async () => {\r\n        console.log('Products page loaded');\r\n        const grid = document.getElementById('productsGrid');\r\n\r\n        if (!grid) {\r\n            console.error('Products grid not found!');\r\n            return;\r\n        }\r\n\r\n        console.log('Products grid found, loading products...');\r\n\r\n        try {\r\n            // Fetch products data\r\n            const res = await fetch('/src/data/products.json', {\r\n                cache: 'no-cache'\r\n            });\r\n\r\n            if (!res.ok) {\r\n                throw new Error(`HTTP error! status: ${res.status}`);\r\n            }\r\n\r\n            const products = await res.json();\r\n            console.log('Products loaded:', products.length, 'products');\r\n\r\n            products.forEach((product) => {\r\n                const card = createProductCard(product);\r\n                grid.appendChild(card);\r\n            });\r\n\r\n            console.log('Product cards added to grid');\r\n\r\n            // Check if we need to scroll to cart section\r\n            if (window.location.hash === '#cart') {\r\n                setTimeout(() => {\r\n                    const cartSection = document.getElementById('cart');\r\n                    if (cartSection) {\r\n                        cartSection.scrollIntoView({\r\n                            behavior: 'smooth',\r\n                            block: 'start'\r\n                        });\r\n                    }\r\n                }, 500); // Small delay to ensure page is loaded\r\n            }\r\n        } catch (err) {\r\n            console.error('Error loading products:', err);\r\n        }\r\n    });\r\n})();"],"file":"products.e666bbbf.js"}