var t=Object.defineProperty,e=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,i=(t,e,n)=>new Promise((o,a)=>{var r=t=>{try{c(n.next(t))}catch(e){a(e)}},i=t=>{try{c(n.throw(t))}catch(e){a(e)}},c=t=>t.done?o(t.value):Promise.resolve(t.value).then(r,i);c((n=n.apply(t,e)).next())});import"./toast.f81f0a6b.js";import{_ as c}from"./cart.5ce05c2a.js";import"./mobile-nav.4ed993c7.js";import"./cartIconPopUp.a61cae76.js";import"./toastService.54c35f7e.js";var l,d,s=(l={"broker.7db5dba1.js"(t){function e(){const t=document.getElementById("cartCount");if(!t)return;let e=0;window.OrdersModule&&(e+=window.OrdersModule.getItemCount()),window.PreordersModule&&(e+=window.PreordersModule.getItemCount()),window.InquiryModule&&(e+=window.InquiryModule.getItemCount()),t.textContent=e,t.style.display=e>0?"block":"none"}function l(){window.OrdersModule&&window.OrdersModule.addItem()}function d(){window.OrdersModule&&window.OrdersModule.submitOrder()}function s(){window.PreordersModule&&window.PreordersModule.addPreorder()}function u(){window.PreordersModule&&window.PreordersModule.submitPreorders()}function m(){window.InquiryModule&&window.InquiryModule.addInquiry()}function p(){window.InquiryModule&&window.InquiryModule.submitInquiries()}function g(){localStorage.removeItem("authState"),localStorage.removeItem("brokerInfo"),y("Logging out...","success");const t=window.location.pathname.includes("/Eastleigh_Turf_Grass/")?"/Eastleigh_Turf_Grass":"";window.location.href=t+"/index.html"}function y(t,e="success"){const n=document.getElementById("toast"),o=n.querySelector(".toast-message"),a=n.querySelector(".toast-icon i");o.textContent=t,"success"===e?(a.className="fas fa-check-circle",n.className="toast success"):"error"===e?(a.className="fas fa-exclamation-circle",n.className="toast error"):"info"===e&&(a.className="fas fa-info-circle",n.className="toast info"),n.classList.remove("hidden"),setTimeout(()=>{b()},4e3)}function b(){document.getElementById("toast").classList.add("hidden")}window.numberFormatter=new class{constructor(){this.isFormatting=!1}initInputFormatting(t,e={}){if(!t)return void console.warn("NumberFormatter: No input element provided");console.log("NumberFormatter: Initializing formatting for input:",t.id||t.name);const i=((t,e)=>{for(var i in e||(e={}))o.call(e,i)&&r(t,i,e[i]);if(n)for(var i of n(e))a.call(e,i)&&r(t,i,e[i]);return t})({allowDecimals:!0,decimalPlaces:2,currency:"KES"},e);t._numberFormatterConfig=i,t.addEventListener("input",t=>{this.handleInputFormatting(t)}),t.addEventListener("keydown",t=>{this.handleKeyDown(t)}),t.addEventListener("blur",t=>{this.handleInputBlur(t)}),t.setAttribute("inputmode","decimal"),console.log("NumberFormatter: Formatting initialized successfully for:",t.id||t.name)}handleInputFormatting(t){if(this.isFormatting)return;const e=t.target,n=e._numberFormatterConfig||{},o=e.selectionStart||0,a=e.value;console.log("NumberFormatter: Input event triggered for:",e.id||e.name,"Value:",a);const r=this.countDigitsBeforePosition(a,o);let i=a.replace(/[^\d.]/g,"");if(n.allowDecimals){const t=i.indexOf(".");-1!==t&&(i=i.substring(0,t+1)+i.substring(t+1).replace(/\./g,""))}else i=i.replace(/\./g,"");const c=this.formatNumberWithCommas(i,n);this.isFormatting=!0,e.value=c,this.isFormatting=!1;const l=this.getPositionAfterDigits(c,r);setTimeout(()=>{e.setSelectionRange(l,l)},0)}handleKeyDown(t){"Enter"===t.key&&(t.preventDefault(),t.target.blur())}handleInputBlur(t){const e=t.target,n=e._numberFormatterConfig||{};n.allowDecimals&&this.ensureProperDecimalFormatting(e,n);const o=new CustomEvent("numberFormatted",{detail:{input:e,value:e.value,numericValue:this.parseFormattedNumber(e.value)}});e.dispatchEvent(o)}countDigitsBeforePosition(t,e){let n=0;for(let o=0;o<Math.min(e,t.length);o++)/\d/.test(t[o])&&n++;return n}getPositionAfterDigits(t,e){let n=0,o=0;for(let a=0;a<t.length;a++){if(/\d/.test(t[a])&&(n++,n===e)){o=a+1;break}n<e&&(o=a+1)}return Math.min(o,t.length)}formatNumberWithCommas(t,e={}){if(!t)return"";const{allowDecimals:n=!0,decimalPlaces:o=2}=e;if(n){const e=t.split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.length>1&&(e[1]=e[1].substring(0,o)),e.join(".")}return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")}ensureProperDecimalFormatting(t,e={}){const n=t.value,o=this.parseFormattedNumber(n);if(o>0){const n=this.formatCurrency(o,e);t.value=n}}parseFormattedNumber(t){return t&&parseFloat(t.replace(/,/g,""))||0}formatCurrency(t,e={}){const{decimalPlaces:n=2}=e;return t.toLocaleString("en-US",{minimumFractionDigits:n,maximumFractionDigits:n})}formatCurrencyDisplay(t,e={}){const{currency:n="KES"}=e,o=this.formatCurrency(t,e);return"".concat(n," ").concat(o)}},window.initNumberFormatting=function(t,e={}){window.numberFormatter?window.numberFormatter.initInputFormatting(t,e):console.warn("Number formatter not available")},document.addEventListener("DOMContentLoaded",function(){(function(){const t=document.querySelectorAll(".nav-tab"),e=document.querySelectorAll(".tab-content");t.forEach(n=>{n.addEventListener("click",()=>{const o=n.getAttribute("data-tab");t.forEach(t=>t.classList.remove("active")),e.forEach(t=>t.classList.remove("active")),n.classList.add("active"),document.getElementById("".concat(o,"-content")).classList.add("active")})})})(),function(){const t=document.getElementById("addItemBtn");t&&t.addEventListener("click",l);const e=document.getElementById("submitOrderBtn");e&&e.addEventListener("click",d);const n=document.getElementById("addPreorderBtn");n&&n.addEventListener("click",s);const o=document.getElementById("submitPreordersBtn");o&&o.addEventListener("click",u);const a=document.getElementById("addInquiryBtn");a&&a.addEventListener("click",m);const r=document.getElementById("submitInquiriesBtn");r&&r.addEventListener("click",p);const i=document.getElementById("logoutBtn");i&&i.addEventListener("click",g)}(),function(){const t=localStorage.getItem("authState");if(t)try{const e=JSON.parse(t);e.loggedIn&&e.user&&function(t){const e=document.getElementById("broker-name"),n=document.getElementById("broker-email");e&&(e.value=t.username||"Broker User"),n&&(n.value=t.email||"broker@eastleighturf.com")}(e.user)}catch(n){console.error("Error parsing auth state:",n)}e()}(),setTimeout(()=>{y("Login Successful\nWelcome to your broker dashboard.","success")},500)}),window.BrokerDashboard={showToast:y,hideToast:b,handleLogout:g,updateCartCount:e},document.addEventListener("click",function(t){t.target.classList.contains("toast-close")&&b()});class f{constructor(){this.elements={orderTotalSpan:document.getElementById("orderTotal"),amountToPayInput:document.getElementById("amount-to-pay-input"),creditBalanceSpan:document.getElementById("credit-balance")},this.initialize()}initialize(){console.log("PaymentSummaryHandler: Initializing..."),this.areElementsValid()?(console.log("PaymentSummaryHandler: Elements found, setting up event listeners..."),this.setupEventListeners(),this.updateCreditBalance(),console.log("PaymentSummaryHandler: Initialization complete")):console.warn("Payment summary elements not found")}areElementsValid(){const{orderTotalSpan:t,amountToPayInput:e,creditBalanceSpan:n}=this.elements;return!!(t&&e&&n)}setupEventListeners(){const{amountToPayInput:t}=this.elements;t&&(this.initializeNumberFormatting(),t.addEventListener("numberFormatted",()=>{this.updateCreditBalance()}),t.addEventListener("blur",()=>{this.updateCreditBalance()}),t.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),t.blur())}))}initializeNumberFormatting(){const{amountToPayInput:t}=this.elements;if(console.log("PaymentSummaryHandler: Initializing number formatting..."),console.log("PaymentSummaryHandler: numberFormatter available?",!!window.numberFormatter),window.numberFormatter)console.log("PaymentSummaryHandler: Using number formatter"),window.numberFormatter.initInputFormatting(t,{allowDecimals:!0,decimalPlaces:2,currency:"KES"});else{console.log("PaymentSummaryHandler: Waiting for number formatter...");const e=setInterval(()=>{window.numberFormatter&&(console.log("PaymentSummaryHandler: Number formatter now available, initializing..."),window.numberFormatter.initInputFormatting(t,{allowDecimals:!0,decimalPlaces:2,currency:"KES"}),clearInterval(e))},100)}}updateCreditBalance(){const{orderTotalSpan:t,amountToPayInput:e,creditBalanceSpan:n}=this.elements;if(!t||!e||!n)return void console.warn("Cannot update credit balance: missing elements");const o=window.numberFormatter?window.numberFormatter.parseFormattedNumber(t.textContent||""):0,a=window.numberFormatter?window.numberFormatter.parseFormattedNumber(e.value):0,r=Math.max(0,o-a);n.textContent=window.numberFormatter?window.numberFormatter.formatCurrency(r):r.toFixed(2)}}function h(){window.paymentSummaryHandler=new f}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h(),(()=>{let e=[],n=[],o=1,a=null,r=[],c=[],l=null,d=null;function s(){return i(this,null,function*(){yield function(){return i(this,null,function*(){try{const t=yield fetch("/src/data/products.json");e=yield t.json(),console.log("Products loaded:",e.length,"products")}catch(t){console.error("Failed to load products:",t),P("Failed to load products","error")}})}(),yield function(){return i(this,null,function*(){try{const t=yield fetch("/src/data/discounts.json"),e=yield t.json();r=e.promotions.filter(t=>t.active),console.log("Discounts loaded:",r.length,"active discounts")}catch(t){console.error("Failed to load discounts:",t),r=[]}})}(),yield function(){return i(this,null,function*(){try{const t=yield fetch("/src/data/coupons.json"),e=yield t.json();c=e.coupons.filter(t=>t.usedCount<t.usageLimit&&new Date>=new Date(t.validFrom)&&new Date<=new Date(t.validTo)),console.log("Coupons loaded:",c.length,"available coupons")}catch(t){console.error("Failed to load coupons:",t),c=[]}})}(),function(){const t=localStorage.getItem("brokerInfo");a=t?JSON.parse(t):{id:"BROKER001",name:"Broker User",email:"broker@eastleighturf.com",phone:"+254700000000"}}(),F(),function(){const t=document.getElementById("addItemBtn"),e=document.getElementById("submitOrderBtn");t&&t.addEventListener("click",u),e&&e.addEventListener("click",L)}()})}function u(){!function(){const t=document.getElementById("addItemModal");t&&t.remove();const n='\n            <div id="addItemModal" class="modal-overlay">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Add Order Item</h2>\n                        <button class="modal-close" id="closeAddItemModal" aria-label="Close modal">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    </div>\n                    <div class="modal-body">\n                        <form id="addItemForm">\n                            <div class="form-group">\n                                <label for="modalProduct">Product *</label>\n                                <select id="modalProduct" required>\n                                    <option value="">Select a product</option>\n                                    '.concat(e.map(t=>'<option value="'.concat(t.id,'">').concat(t.name," (").concat(t.thickness,")</option>")).join(""),'\n                                </select>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="modalQuantity">Quantity (m²) *</label>\n                                <input type="number" id="modalQuantity" min="0.1" step="0.1" required placeholder="Enter quantity">\n                            </div>\n\n                            <div class="form-group">\n                                <label>Unit Price (KES)</label>\n                                <input type="text" id="modalUnitPrice" readonly value="0">\n                            </div>\n\n                            <div class="form-group">\n                                <label>Subtotal (KES)</label>\n                                <input type="text" id="modalSubtotal" readonly value="0">\n                            </div>\n\n                            <div class="discount-section">\n                                <h3>Discounts & Coupons</h3>\n                                \n                                <div class="form-group">\n                                    <label for="modalDiscount">Available Discounts</label>\n                                    <select id="modalDiscount" disabled>\n                                        <option value="">No discount</option>\n                                        ').concat(r.map(t=>'<option value="'.concat(t.id,'">').concat(t.name," - ").concat(t.description,"</option>")).join(""),'\n                                    </select>\n                                </div>\n\n                                <div class="form-group">\n                                    <label for="modalCoupon">Coupon Code</label>\n                                    <div class="coupon-input-group">\n                                        <input type="text" id="modalCoupon" placeholder="Enter coupon code" disabled>\n                                        <button type="button" id="applyCouponBtn" disabled>Apply</button>\n                                    </div>\n                                </div>\n\n                                <div class="discount-summary" id="discountSummary" style="display: none;">\n                                    <div class="summary-row">\n                                        <span>Subtotal:</span>\n                                        <span id="summarySubtotal">KES 0</span>\n                                    </div>\n                                    <div class="summary-row discount-row" id="discountRow" style="display: none;">\n                                        <span>Discount:</span>\n                                        <span id="summaryDiscount">-KES 0</span>\n                                    </div>\n                                    <div class="summary-row coupon-row" id="couponRow" style="display: none;">\n                                        <span>Coupon:</span>\n                                        <span id="summaryCoupon">-KES 0</span>\n                                    </div>\n                                    <div class="summary-row final-total">\n                                        <span>Final Total:</span>\n                                        <span id="summaryFinalTotal">KES 0</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </form>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-secondary" id="cancelAddItem">Cancel</button>\n                        <button type="button" class="btn btn-primary" id="confirmAddItem" disabled>Add to Order</button>\n                    </div>\n                </div>\n            </div>\n        ');document.body.insertAdjacentHTML("beforeend",n),function(){const t=document.getElementById("addItemModal"),e=document.getElementById("closeAddItemModal"),n=document.getElementById("cancelAddItem"),o=document.getElementById("confirmAddItem"),a=document.getElementById("modalProduct"),r=document.getElementById("modalQuantity"),i=document.getElementById("applyCouponBtn");if(e&&e.addEventListener("click",I),n&&n.addEventListener("click",I),o&&o.addEventListener("click",E),a&&a.addEventListener("change",m),r)if(r.addEventListener("input",p),window.numberFormatter)window.numberFormatter.initInputFormatting(r,{allowDecimals:!0,decimalPlaces:1,currency:"KES"});else{const t=setInterval(()=>{window.numberFormatter&&(window.numberFormatter.initInputFormatting(r,{allowDecimals:!0,decimalPlaces:1,currency:"KES"}),clearInterval(t))},100)}i&&i.addEventListener("click",f),t&&t.addEventListener("click",e=>{e.target===t&&I()})}()}();const t=document.getElementById("addItemModal");t&&(t.style.display="flex",b())}function m(){const t=document.getElementById("modalProduct");document.getElementById("modalQuantity");const n=document.getElementById("modalUnitPrice"),o=document.getElementById("modalSubtotal");if(t&&t.value){const o=e.find(e=>e.id===t.value);o&&(n.value=o.price.toLocaleString("en-US"),g(),y())}else n.value="0",o.value="0",b()}function p(){g(),y()}function g(){const t=document.getElementById("modalProduct"),n=document.getElementById("modalQuantity"),o=document.getElementById("modalSubtotal");if(t&&t.value&&n&&n.value){const a=e.find(e=>e.id===t.value),r=window.numberFormatter?window.numberFormatter.parseFormattedNumber(n.value):parseFloat(n.value)||0,i=a.price*r;o.value=window.numberFormatter?window.numberFormatter.formatCurrency(i):i.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),h()}else o.value="0"}function y(){const t=document.getElementById("modalProduct"),e=document.getElementById("modalQuantity");document.getElementById("modalDiscount"),document.getElementById("modalCoupon"),document.getElementById("applyCouponBtn");const n=document.getElementById("confirmAddItem"),o=t&&t.value,a=e&&e.value&&(window.numberFormatter?window.numberFormatter.parseFormattedNumber(e.value):parseFloat(e.value))>0;o&&a?(function(){const t=document.getElementById("modalDiscount"),e=document.getElementById("modalCoupon"),n=document.getElementById("applyCouponBtn");t&&(t.disabled=!1),e&&(e.disabled=!1),n&&(n.disabled=!1),t&&t.addEventListener("change",h)}(),n&&(n.disabled=!1)):(b(),n&&(n.disabled=!0))}function b(){const t=document.getElementById("modalDiscount"),e=document.getElementById("modalCoupon"),n=document.getElementById("applyCouponBtn");t&&(t.disabled=!0,t.value=""),e&&(e.disabled=!0,e.value=""),n&&(n.disabled=!0),l=null,d=null,h()}function f(){const t=document.getElementById("modalCoupon").value.trim().toUpperCase();if(!t)return void P("Please enter a coupon code","error");const e=c.find(e=>e.code===t);e?v()<e.minOrder?P("Minimum order amount for this coupon is KES ".concat(e.minOrder.toLocaleString()),"error"):(d=e,P("Coupon ".concat(e.code," applied successfully!"),"success"),h()):P("Invalid coupon code","error")}function h(){const t=v(),e=document.getElementById("discountSummary"),n=document.getElementById("summarySubtotal"),o=document.getElementById("discountRow"),a=document.getElementById("summaryDiscount"),i=document.getElementById("couponRow"),c=document.getElementById("summaryCoupon"),s=document.getElementById("summaryFinalTotal");if(!e)return;n.textContent="KES ".concat(t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}));let u=t,m=0,p=0;const g=document.getElementById("modalDiscount");if(g&&g.value){const e=r.find(t=>t.id===g.value);e&&t>=e.minOrder&&("percentage"===e.type?(m=t*e.value/100,e.maxDiscount&&(m=Math.min(m,e.maxDiscount))):m=e.value,u-=m,l=e)}d&&("percentage"===d.type?(p=t*d.value/100,d.maxDiscount&&(p=Math.min(p,d.maxDiscount))):p=d.value,u-=p),m>0?(o.style.display="flex",a.textContent="-KES ".concat(m.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))):o.style.display="none",p>0?(i.style.display="flex",c.textContent="-KES ".concat(p.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))):i.style.display="none",s.textContent="KES ".concat(u.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),e.style.display="block"}function v(){const t=document.getElementById("modalProduct"),n=document.getElementById("modalQuantity");if(t&&t.value&&n&&n.value){const o=e.find(e=>e.id===t.value),a=parseFloat(n.value)||0;return o.price*a}return 0}function E(){const t=document.getElementById("modalProduct"),a=document.getElementById("modalQuantity");if(!t.value||!a.value)return void P("Please select a product and enter quantity","error");const r=e.find(e=>e.id===t.value),i=parseFloat(a.value),c=v(),s={id:o++,productId:r.id,product:r,quantity:i,unitPrice:r.price,subtotal:c,discount:l,coupon:d,finalTotal:c-(l?w(c,l):0)-(d?S(c,d):0)};n.push(s),I(),F(),P("Item added to order","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function w(t,e){if("percentage"===e.type){let n=t*e.value/100;return e.maxDiscount&&(n=Math.min(n,e.maxDiscount)),n}return e.value}function S(t,e){if("percentage"===e.type){let n=t*e.value/100;return e.maxDiscount&&(n=Math.min(n,e.maxDiscount)),n}return e.value}function I(){const t=document.getElementById("addItemModal");t&&t.remove(),l=null,d=null}function B(t){n=n.filter(e=>e.id!==t),F(),P("Item removed from order","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function D(){return n.reduce((t,e)=>t+e.finalTotal,0)}function F(){const t=document.getElementById("orderTableBody"),e=document.getElementById("emptyOrderState"),o=document.getElementById("orderTotal"),a=document.getElementById("submitOrderBtn");if(!(t&&e&&o&&a))return;0===n.length?(t.innerHTML="",e.style.display="block",a.disabled=!0):(e.style.display="none",a.disabled=!1,t.innerHTML=n.map(t=>function(t){const e=t.discount?"".concat(t.discount.name," (-").concat(t.discount.value,"%)"):"",n=t.coupon?"".concat(t.coupon.code," (-").concat(t.coupon.value).concat("percentage"===t.coupon.type?"%":" KES",")"):"";return'\n            <tr>\n                <td>\n                    <div class="order-field">\n                        <label>Product Name</label>\n                        <strong>'.concat(t.product.name," (").concat(t.product.thickness,')</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Quantity (m²)</label>\n                        <strong>').concat(t.quantity,'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Unit Price (KES)</label>\n                        <strong>').concat(t.unitPrice.toLocaleString("en-US"),'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Subtotal (KES)</label>\n                        <strong>').concat(t.subtotal.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),'</strong>\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Final Total (KES)</label>\n                        <strong>').concat(t.finalTotal.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),"</strong>\n                        ").concat(e||n?'<br><small class="discount-info">'.concat(e).concat(e&&n?", ":"").concat(n,"</small>"):"",'\n                    </div>\n                </td>\n                <td>\n                    <div class="order-field">\n                        <label>Action</label>\n                        <button class="delete-btn" id="delete-').concat(t.id,'">\n                            <i class="fas fa-trash"></i> Delete\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        ')}(t)).join(""),n.forEach(t=>{const e=document.getElementById("delete-".concat(t.id));e&&e.addEventListener("click",()=>{B(t.id)})}));const r=D();o.textContent=r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),window.paymentSummaryHandler&&window.paymentSummaryHandler.updateCreditBalance&&window.paymentSummaryHandler.updateCreditBalance()}function L(){0!==n.length?function(t){const e=function(t){const e=t.items.map(t=>{let e="• ".concat(t.product.name," (").concat(t.product.thickness,")\n");return e+="  Quantity: ".concat(t.quantity," m²\n"),e+="  Unit Price: KES ".concat(t.unitPrice.toLocaleString(),"\n"),e+="  Subtotal: KES ".concat(t.subtotal.toLocaleString()),(t.discount||t.coupon)&&(e+="\n  Final Total: KES ".concat(t.finalTotal.toLocaleString()),t.discount&&(e+=" (".concat(t.discount.name," applied)")),t.coupon&&(e+=" (".concat(t.coupon.code," applied)"))),e}).join("\n\n");return"*BROKER ORDER SUBMISSION - Eastleigh Turf Grass*\n\n*Broker Details:*\n• ID: ".concat(t.brokerId,"\n• Name: ").concat(t.brokerName,"\n• Email: ").concat(t.brokerEmail,"\n• Phone: ").concat(t.brokerPhone,"\n\n*Order Items:*\n").concat(e,"\n\n*Order Summary:*\n• Total Items: ").concat(t.items.length,"\n• Subtotal: KES ").concat(t.subtotal.toLocaleString(),"\n• Total Discount: KES ").concat(t.totalDiscount.toLocaleString(),"\n• Final Total: KES ").concat(t.total.toLocaleString(),"\n\n*Submitted:* ").concat((new Date).toLocaleString("en-KE"))}(t);if(window.WhatsAppService&&window.WhatsAppService.sendToWhatsApp)window.WhatsAppService.sendToWhatsApp(e,"broker-order")?(P("Order sent to WhatsApp successfully!","success"),n=[],F()):P("Failed to send order to WhatsApp","error");else{const t="254743375997",o=encodeURIComponent(e),a="https://wa.me/".concat(t,"?text=").concat(o);window.open(a,"_blank"),P("Order opened in WhatsApp!","success"),n=[],F()}}({brokerId:a.id,brokerName:a.name,brokerEmail:a.email,brokerPhone:a.phone,items:n,total:D(),subtotal:n.reduce((t,e)=>t+e.subtotal,0),totalDiscount:n.reduce((t,e)=>{let n=0;return e.discount&&(n+=w(e.subtotal,e.discount)),e.coupon&&(n+=S(e.subtotal,e.coupon)),t+n},0),orderDate:(new Date).toISOString()}):P("No items in order","error")}function P(t,e="success"){const n=document.getElementById("toast"),o=n.querySelector(".toast-message");n&&o&&(n.className="toast ".concat(e),o.textContent=t,n.classList.remove("hidden"),setTimeout(()=>{n.classList.add("hidden")},3e3))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>i(t,null,function*(){yield s()})):i(t,null,function*(){yield s()}),window.OrdersModule={addItem:u,removeItem:B,getItemCount:function(){return n.length},calculateTotal:D,updateUI:F,submitOrder:L}})();const v=new class{constructor(){this.whatsappNumber="254743375997",this.businessName="Eastleigh Turf Grass",this.baseUrl="https://wa.me"}sendOrder(t){try{const e=this.generateOrderMessage(t),n=this.generateWhatsAppUrl(e);return window.open(n,"_blank"),!0}catch(e){return console.error("WhatsApp Service Error:",e),!1}}sendPreorder(t){try{const e=this.generatePreorderMessage(t),n=this.generateWhatsAppUrl(e);return window.open(n,"_blank"),!0}catch(e){return console.error("WhatsApp Service Error:",e),!1}}sendInquiry(t){try{const e=this.generateInquiryMessage(t),n=this.generateWhatsAppUrl(e);return window.open(n,"_blank"),!0}catch(e){return console.error("WhatsApp Service Error:",e),!1}}sendContact(t){try{const e=this.generateContactMessage(t),n=this.generateWhatsAppUrl(e);return window.open(n,"_blank"),!0}catch(e){return console.error("WhatsApp Service Error:",e),!1}}generateWhatsAppUrl(t){const e=encodeURIComponent(t);return"".concat(this.baseUrl,"/").concat(this.whatsappNumber,"?text=").concat(e)}generateOrderMessage(t){const{brokerId:e,brokerName:n,brokerEmail:o,brokerPhone:a,items:r,total:i,subtotal:c,totalDiscount:l,orderDate:d}=t,s=r.map(t=>{let e="• ".concat(t.product.name," (").concat(t.product.thickness,")\n");return e+="  Quantity: ".concat(t.quantity," m²\n"),e+="  Unit Price: KES ".concat(t.unitPrice.toLocaleString(),"\n"),e+="  Subtotal: KES ".concat(t.subtotal.toLocaleString()),(t.discount||t.coupon)&&(e+="\n  Final Total: KES ".concat(t.finalTotal.toLocaleString()),t.discount&&(e+=" (".concat(t.discount.name," applied)")),t.coupon&&(e+=" (".concat(t.coupon.code," applied)"))),e}).join("\n\n");return"*BROKER ORDER SUBMISSION - ".concat(this.businessName,"*\n\n*Broker Details:*\n• ID: ").concat(e,"\n• Name: ").concat(n,"\n• Email: ").concat(o,"\n• Phone: ").concat(a,"\n\n*Order Items:*\n").concat(s,"\n\n*Order Summary:*\n• Total Items: ").concat(r.length,"\n• Subtotal: KES ").concat(c.toLocaleString(),"\n• Total Discount: KES ").concat(l.toLocaleString(),"\n• Final Total: KES ").concat(i.toLocaleString(),"\n\n*Submitted:* ").concat(new Date(d).toLocaleString("en-KE"))}generatePreorderMessage(t){const{brokerName:e,brokerEmail:n,items:o,expectedDate:a,specialNotes:r,total:i}=t,c=o.map(t=>"• ".concat(t.product.name," (").concat(t.product.thickness,")\n  Quantity: ").concat(t.quantity," m²\n  Unit Price: KES ").concat(t.unitPrice.toLocaleString(),"\n  Total: KES ").concat(t.total.toLocaleString())).join("\n\n");return"*BROKER PREORDER SUBMISSION - ".concat(this.businessName,"*\n\n*Broker Details:*\n• Name: ").concat(e,"\n• Email: ").concat(n,"\n\n*Preorder Items:*\n").concat(c,"\n\n*Preorder Details:*\n• Expected Date: ").concat(a||"Not specified","\n• Special Notes: ").concat(r||"None","\n• Total Amount: KES ").concat(i.toLocaleString(),"\n\n*Submitted:* ").concat((new Date).toLocaleString("en-KE"))}generateInquiryMessage(t){const{brokerName:e,brokerEmail:n,items:o,totalOriginal:a,totalBargain:r}=t,i=o.map(t=>{const e=t.bargainPrice-t.originalPrice,n=e>0?"+KES ".concat(e.toLocaleString()):"-KES ".concat(Math.abs(e).toLocaleString());return"• ".concat(t.product.name," (").concat(t.product.thickness,")\n  Original Price: KES ").concat(t.originalPrice.toLocaleString(),"\n  Bargain Price: KES ").concat(t.bargainPrice.toLocaleString(),"\n  Difference: ").concat(n)}).join("\n\n"),c=r-a,l=c>0?"+KES ".concat(c.toLocaleString()):"-KES ".concat(Math.abs(c).toLocaleString());return"*BROKER PRICE INQUIRY - ".concat(this.businessName,"*\n\n*Broker Details:*\n• Name: ").concat(e,"\n• Email: ").concat(n,"\n\n*Price Inquiries:*\n").concat(i,"\n\n*Inquiry Summary:*\n• Total Original Value: KES ").concat(a.toLocaleString(),"\n• Total Bargain Value: KES ").concat(r.toLocaleString(),"\n• Total Difference: ").concat(l,"\n\n*Submitted:* ").concat((new Date).toLocaleString("en-KE"))}generateContactMessage(t){const{name:e,email:n,phone:o,subject:a,message:r}=t;return"*CONTACT FORM SUBMISSION - ".concat(this.businessName,"*\n\n*Customer Details:*\n• Name: ").concat(e,"\n• Email: ").concat(n,"\n• Phone: ").concat(o,"\n\n*Message:*\nSubject: ").concat(a,"\nMessage: ").concat(r,"\n\n*Submitted:* ").concat((new Date).toLocaleString("en-KE"))}sendToWhatsApp(t,e="general"){try{const e=this.generateWhatsAppUrl(t);return window.open(e,"_blank"),!0}catch(n){return console.error("WhatsApp Service Error:",n),!1}}sendOrderForm(t){return this.sendOrder(t)}sendPreorderForm(t){return this.sendPreorder(t)}sendInquiryForm(t){return this.sendInquiry(t)}sendContactForm(t){return this.sendContact(t)}};window.WhatsAppService=v;try{c(()=>import("./preorders.a819c41b.js"),[])}catch(w){console.warn("Preorders module not available:",w)}try{c(()=>import("./inquiry.71288545.js"),[])}catch(w){console.warn("Inquiry module not available:",w)}function E(){return window.location.pathname.includes("/Eastleigh_Turf_Grass/")?"/Eastleigh_Turf_Grass":""}document.addEventListener("DOMContentLoaded",function(){console.log("Broker dashboard initialized");const t=localStorage.getItem("authState");if(!t){const t=E();return void(window.location.href=t+"/index.html")}try{const e=JSON.parse(t);if(!e.loggedIn||!e.user){const t=E();return void(window.location.href=t+"/index.html")}const n={id:"BROKER001",name:e.user.username||"Broker User",email:e.user.email||"broker@eastleighturf.com",phone:e.user.phone||"+254700000000"};localStorage.setItem("brokerInfo",JSON.stringify(n))}catch(w){console.error("Error parsing auth state:",w);const e=E();return void(window.location.href=e+"/index.html")}window.BrokerDashboard?console.log("Broker dashboard modules loaded successfully"):console.error("Broker dashboard modules failed to load")})}},function(){return d||(0,l[e(l)[0]])((d={exports:{}}).exports,d),d.exports});export default s();
//# sourceMappingURL=broker.7db5dba1.js.map
