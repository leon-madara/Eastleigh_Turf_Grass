var $=(m,a,d)=>new Promise((p,w)=>{var I=s=>{try{l(d.next(s))}catch(g){w(g)}},h=s=>{try{l(d.throw(s))}catch(g){w(g)}},l=s=>s.done?p(s.value):Promise.resolve(s.value).then(I,h);l((d=d.apply(m,a)).next())});(()=>{let m=[],a=[],d=1;function p(){w(),b()}function w(){return $(this,null,function*(){try{m=yield(yield fetch("/src/data/products.json")).json()}catch(t){console.error("Failed to load products:",t),showToast("Failed to load products","error")}})}function I(){const t={id:d++,productId:"",product:null,originalPrice:0,bargainPrice:0,difference:0};a.push(t),b(),showToast("Inquiry added","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function h(t){a=a.filter(r=>r.id!==t),b(),showToast("Inquiry removed","success"),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()}function l(t,r,n){const e=a.find(i=>i.id===t);if(e){if(r==="productId"){const i=m.find(o=>o.id===n);e.productId=n,e.product=i,e.originalPrice=i?i.price:0,e.difference=e.bargainPrice-e.originalPrice}else r==="bargainPrice"&&(e.bargainPrice=window.numberFormatter?window.numberFormatter.parseFormattedNumber(n):parseFloat(n)||0,e.difference=e.bargainPrice-e.originalPrice);b()}}function s(t){return t<0?"negative":t>0?"positive":"neutral"}function g(t){const r=Math.abs(t),n=t<0?"-":t>0?"+":"";return"".concat(n,"KES ").concat(r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))}function b(){const t=document.getElementById("inquiryTableBody"),r=document.getElementById("emptyInquiryState"),n=document.getElementById("submitInquiriesBtn");!t||!r||!n||(a.length===0?(t.innerHTML="",r.style.display="block",n.disabled=!0):(r.style.display="none",n.disabled=!1,t.innerHTML=a.map(e=>S(e)).join(""),a.forEach(e=>{const i=document.getElementById("inquiry-product-".concat(e.id)),o=document.getElementById("bargain-".concat(e.id)),u=document.getElementById("delete-inquiry-".concat(e.id));if(i&&i.addEventListener("change",c=>{l(e.id,"productId",c.target.value)}),o)if(o.addEventListener("input",c=>{l(e.id,"bargainPrice",c.target.value)}),window.numberFormatter)window.numberFormatter.initInputFormatting(o,{allowDecimals:!0,decimalPlaces:2,currency:"KES"});else{const c=setInterval(()=>{window.numberFormatter&&(window.numberFormatter.initInputFormatting(o,{allowDecimals:!0,decimalPlaces:2,currency:"KES"}),clearInterval(c))},100)}u&&u.addEventListener("click",()=>{h(e.id)})})))}function S(t){const r=m.map(i=>'<option value="'.concat(i.id,'" ').concat(t.productId===i.id?"selected":"",">\n                ").concat(i.name," (").concat(i.thickness,")\n            </option>")).join(""),n=s(t.difference),e=g(t.difference);return'\n            <tr>\n                <td>\n                  <div class="order-field">\n                    <label for="inquiry-product-'.concat(t.id,'">Product Name</label>\n                    <select class="table-select" id="inquiry-product-').concat(t.id,'">\n                        <option value="">Select a product</option>\n                        ').concat(r,'\n                    </select>\n                  </div>\n                </td>\n                <td>\n                  <div class="order-field">\n                    <label>Original Price (KES)</label>\n                    <input type="text" class="table-input" readonly \n                           value="').concat(t.originalPrice.toLocaleString("en-US"),'">\n                  </div>\n                </td>\n                <td>\n                  <div class="order-field">\n                    <label for="bargain-').concat(t.id,'">Your Bargain Price (KES)</label>\n                    <input type="number" inputmode="decimal" class="table-input" id="bargain-').concat(t.id,'" \n                           value="').concat(t.bargainPrice,'" min="0" step="0.01" placeholder="0">\n                  </div>\n                </td>\n                <td>\n                  <div class="order-field">\n                    <label>Price Difference</label>\n                    <span class="price-difference ').concat(n,'">').concat(e,'</span>\n                  </div>\n                </td>\n                <td>\n                  <div class="order-field">\n                    <label>Action</label>\n                    <button class="delete-btn" id="delete-inquiry-').concat(t.id,'">\n                        <i class="fas fa-trash"></i> Delete\n                    </button>\n                  </div>\n                </td>\n            </tr>\n        ')}function y(){if(a.length===0){showToast("No inquiries to submit","error");return}if(a.filter(r=>!r.productId||r.bargainPrice<=0).length>0){showToast("Please complete all inquiries before submitting","error");return}try{const r={brokerName:"Broker User",brokerEmail:"broker@eastleighturf.com",items:a.map(e=>({product:e.product,originalPrice:e.originalPrice,bargainPrice:e.bargainPrice})),totalOriginal:a.reduce((e,i)=>e+i.originalPrice,0),totalBargain:a.reduce((e,i)=>e+i.bargainPrice,0)};let n=!1;if(window.WhatsAppService&&window.WhatsAppService.sendInquiryForm)n=window.WhatsAppService.sendInquiryForm(r);else{const e=v(r),i="254743375997",o=encodeURIComponent(e),u="https://wa.me/".concat(i,"?text=").concat(o);window.open(u,"_blank"),n=!0}n?(showToast("Inquiries submitted successfully! WhatsApp will open with your inquiry details.","success"),a=[],d=1,b(),window.BrokerDashboard&&window.BrokerDashboard.updateCartCount&&window.BrokerDashboard.updateCartCount()):showToast("Failed to send inquiries. Please try again.","error")}catch(r){console.error("Inquiry submission error:",r),showToast("An error occurred while submitting the inquiries.","error")}}function E(){return a.length}function v(t){const{brokerName:r,brokerEmail:n,items:e,totalOriginal:i,totalBargain:o}=t,u=e.map(f=>{const P=f.bargainPrice-f.originalPrice,D=P>0?"+KES ".concat(P.toLocaleString()):"-KES ".concat(Math.abs(P).toLocaleString());return"• ".concat(f.product.name," (").concat(f.product.thickness,")\n  Original Price: KES ").concat(f.originalPrice.toLocaleString(),"\n  Bargain Price: KES ").concat(f.bargainPrice.toLocaleString(),"\n  Difference: ").concat(D)}).join("\n\n"),c=o-i,B=c>0?"+KES ".concat(c.toLocaleString()):"-KES ".concat(Math.abs(c).toLocaleString());return"*BROKER PRICE INQUIRY - Eastleigh Turf Grass*\n\n*Broker Details:*\n• Name: ".concat(r,"\n• Email: ").concat(n,"\n\n*Price Inquiries:*\n").concat(u,"\n\n*Inquiry Summary:*\n• Total Original Value: KES ").concat(i.toLocaleString(),"\n• Total Bargain Value: KES ").concat(o.toLocaleString(),"\n• Total Difference: ").concat(B,"\n\n*Submitted:* ").concat(new Date().toLocaleString("en-KE"))}window.InquiryModule={init:p,addInquiry:I,removeInquiry:h,updateInquiry:l,submitInquiries:y,getItemCount:E},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p()})();
