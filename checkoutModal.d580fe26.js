var e=(e,t,n)=>new Promise((o,s)=>{var a=e=>{try{l(n.next(e))}catch(t){s(t)}},c=e=>{try{l(n.throw(e))}catch(t){s(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(a,c);l((n=n.apply(e,t)).next())});const t={modal:null,isInitialized:!1,init(){console.log("Checkout modal initialized"),this.isInitialized=!0},open(){return e(this,null,function*(){yield this.createModal(),this.showModal(),this.currentStep=1,this.totalSteps=3})},close(){this.hideModal()},createModal(){return e(this,null,function*(){const e=document.getElementById("checkoutModal");e&&e.remove();try{const e=this.getModalHTML();document.body.insertAdjacentHTML("beforeend",e),this.initializeModal(),this.bindEvents(),this.updateStepIndicator(),this.updateOrderSummary()}catch(t){console.error("Error loading checkout modal:",t),this.createFallbackModal()}})},createFallbackModal(){document.body.insertAdjacentHTML("beforeend",'\n            <div id="checkoutModal" class="checkout-modal active">\n                <div class="modal-overlay"></div>\n                <div class="modal-content">\n                    <div class="modal-header">                        \n                        <button class="modal-close" id="closeCheckoutModal" aria-label="Close modal">\n                            <i class="fas fa-times"></i>\n                        <h2>Checkout</h2>\n                        </button>\n                    </div>\n                    <div class="modal-body">\n                        <p>Error loading checkout form. Please try again.</p>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn-secondary" id="closeCheckoutModal">Close</button>\n                    </div>\n                </div>\n            </div>\n        '),this.bindEvents()},initializeModal(){this.currentStep=1,this.totalSteps=3,console.log("Modal initialized, currentStep:",this.currentStep),this.showStep(1),this.updateButtonStates(),this.populateOrderSummary();const e=document.getElementById("backBtn");console.log("Back button in initializeModal:",e),e&&(console.log("Back button styles:",e.style.cssText),console.log("Back button computed styles:",window.getComputedStyle(e)))},showModal(){const e=document.getElementById("checkoutModal");if(e){e.classList.add("active"),e.removeAttribute("hidden"),setTimeout(()=>{this.initFloatingLabels()},100);const t=document.getElementById("customerName");t&&t.focus()}},hideModal(){const e=document.getElementById("checkoutModal");e&&e.remove()},bindEvents(){const e=document.getElementById("closeCheckoutModal");e&&e.addEventListener("click",()=>this.close());const t=document.getElementById("backBtn");t&&t.addEventListener("click",()=>this.previousStep());const n=document.getElementById("nextBtn");n&&n.addEventListener("click",()=>this.nextStep());const o=document.getElementById("sendBtn");o&&o.addEventListener("click",()=>this.sendOrder());document.querySelectorAll(".md3-stepper .step").forEach((e,t)=>{e.addEventListener("click",()=>{const e=t+1;e<=this.currentStep&&this.showStep(e)})});const s=document.getElementById("checkoutModal"),a=document.querySelector(".md3-modal__backdrop");s&&s.addEventListener("click",e=>{e.target!==s&&e.target!==a||this.close()}),a&&a.addEventListener("click",()=>this.close());const c=document.getElementById("customerDetailsForm");c&&c.addEventListener("submit",e=>{e.preventDefault(),this.nextStep()});const l=document.getElementById("detectPhoneBtn");l&&l.addEventListener("click",()=>this.detectPhoneFromContacts());const i=document.getElementById("detectLocationBtn");i&&i.addEventListener("click",()=>this.detectLocationFromGPS()),this.loadSavedDetails(),this.initFloatingLabels()},populateOrderSummary(){const e=window.CartComponent?window.CartComponent.getItems():[],t=window.CartComponent?window.CartComponent.getTotal():0,n=t+500,o=document.getElementById("summaryName"),s=document.getElementById("summaryPhone"),a=document.getElementById("summaryLocation"),c=document.getElementById("totalArea"),l=document.getElementById("summarySubtotal"),i=document.getElementById("summaryDiscount"),d=document.getElementById("summaryTotal");o&&(o.textContent=""),s&&(s.textContent=""),a&&(a.textContent=""),c&&(c.textContent="0 m²"),l&&(l.textContent="KES ".concat(t.toLocaleString())),i&&(i.textContent="-KES 0"),d&&(d.textContent="KES ".concat(n.toLocaleString()));const r=document.getElementById("orderItemsList");r&&e.length>0&&(r.innerHTML=e.map(e=>'\n                <div class="order-item">\n                    <span class="item-name">'.concat(e.name,'</span>\n                    <span class="item-quantity">').concat(e.quantity,' units</span>\n                    <span class="item-price">KES ').concat(e.price.toLocaleString(),"</span>\n                </div>\n            ")).join(""))},updateOrderSummary(){let e=0;window.CartComponent&&(e=window.CartComponent.getTotal());const t=e+500,n=document.getElementById("summarySubtotal"),o=document.getElementById("summaryDelivery"),s=document.getElementById("summaryTotal");n&&(n.textContent="KES ".concat(e.toLocaleString())),o&&(o.textContent="KES ".concat(500..toLocaleString())),s&&(s.textContent="KES ".concat(t.toLocaleString()))},sendOrder(){const e=document.getElementById("customerName")?document.getElementById("customerName").value:"",t=document.getElementById("customerPhone")?document.getElementById("customerPhone").value:"",n=document.getElementById("customerLocation")?document.getElementById("customerLocation").value:"";if(!e||!t||!n)return this.showError("Please fill in all required fields in step 1"),void this.showStep(1);const o=this.generateWhatsAppMessage(e,t,n),s="https://wa.me/254743375997?text=".concat(encodeURIComponent(o));window.open(s,"_blank"),this.showSuccess("Order sent to WhatsApp! Please complete your order there."),setTimeout(()=>{this.close()},3e3)},generateWhatsAppMessage(e,t,n){const o=window.CartComponent?window.CartComponent.getItems():[],s=window.CartComponent?window.CartComponent.getTotal():0;let a="🏠 *TURF GRASS ORDER*\n\n";return a+="*Customer Details:*\n",a+="Name: ".concat(e,"\n"),a+="Phone: +254".concat(t,"\n"),a+="Location: ".concat(n,"\n\n"),a+="*Order Items:*\n",o.forEach(e=>{a+="• ".concat(e.name," - ").concat(e.quantity," units - KES ").concat(e.price.toLocaleString(),"\n")}),a+="\n*Total: KES ".concat(s.toLocaleString(),"*\n\n"),a+="Please confirm this order and provide delivery details.",a},placeOrder(){if(!document.getElementById("checkoutForm"))return;const e=document.getElementById("checkoutName")?document.getElementById("checkoutName").value:"",t=document.getElementById("checkoutEmail")?document.getElementById("checkoutEmail").value:"",n=document.getElementById("checkoutPhone")?document.getElementById("checkoutPhone").value:"",o=document.getElementById("checkoutLocation")?document.getElementById("checkoutLocation").value:"",s=document.getElementById("checkoutAddress")?document.getElementById("checkoutAddress").value:"",a=document.getElementById("checkoutCity")?document.getElementById("checkoutCity").value:"",c=!!document.getElementById("saveDetails")&&document.getElementById("saveDetails").checked,l=!!document.getElementById("allowPhoneContact")&&document.getElementById("allowPhoneContact").checked;window.CartComponent&&window.CartComponent.getItems(),window.CartComponent&&window.CartComponent.getTotal();if(!(e&&t&&n&&o&&s&&a))return void this.showError("Please fill in all required fields");c&&this.saveDetails();const i=l?"phone call":"email";this.showSuccess("Order placed successfully! We will contact you via ".concat(i," soon.")),window.CartComponent&&window.CartComponent.clear(),setTimeout(()=>{this.close()},2e3)},showError(e){console.error("Checkout Error:",e),alert(e)},showSuccess(e){console.log("Checkout Success:",e),alert(e)},detectPhoneFromContacts(){return e(this,null,function*(){const e=document.getElementById("detectPhoneBtn"),t=document.getElementById("customerPhone");if(e&&t){e.classList.add("loading"),e.innerHTML='<i class="fas fa-spinner"></i><span>Detecting...</span>',e.disabled=!0;try{if("contacts"in navigator&&"select"in navigator.contacts){const n=yield navigator.contacts.select(["name","tel"],{multiple:!1});if(!(n&&n.length>0))throw new Error("No contact selected");{const o=n[0],s=o.tel&&o.tel.length>0?o.tel[0]:null;if(!s)throw new Error("No phone number found in selected contact");{let n=s.replace(/\D/g,"");n.startsWith("254")&&(n=n.substring(3)),t.value=n,e.classList.remove("loading"),e.classList.add("success"),e.innerHTML='<i class="fas fa-check"></i><span>Detected</span>',setTimeout(()=>{e.classList.remove("success"),e.innerHTML='<i class="fas fa-address-book"></i><span>Detect from Contacts</span>',e.disabled=!1},2e3),this.showSuccess("Phone number detected from contacts!")}}}else{const n=prompt("Please enter your phone number or copy it from your contacts:");if(!n)throw new Error("No phone number entered");t.value=n.replace(/\D/g,""),e.classList.remove("loading"),e.classList.add("success"),e.innerHTML='<i class="fas fa-check"></i><span>Entered</span>',setTimeout(()=>{e.classList.remove("success"),e.innerHTML='<i class="fas fa-address-book"></i><span>Detect from Contacts</span>',e.disabled=!1},2e3)}}catch(n){console.error("Error detecting phone:",n),e.classList.remove("loading"),e.classList.add("error"),e.innerHTML='<i class="fas fa-exclamation-triangle"></i><span>Failed</span>',setTimeout(()=>{e.classList.remove("error"),e.innerHTML='<i class="fas fa-address-book"></i><span>Detect from Contacts</span>',e.disabled=!1},2e3),this.showError("Could not detect phone number. Please enter it manually.")}}})},detectLocationFromGPS(){return e(this,null,function*(){const e=document.getElementById("detectLocationBtn"),t=document.getElementById("customerLocation");if(e&&t){e.classList.add("loading"),e.innerHTML='<i class="fas fa-spinner"></i><span>Detecting...</span>',e.disabled=!0;try{if(!("geolocation"in navigator))throw new Error("Geolocation not supported");{const o=yield new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),{latitude:s,longitude:a}=o.coords;try{const n=yield fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(s,"&lon=").concat(a,"&zoom=18&addressdetails=1")),o=yield n.json();o.display_name?(t.value=o.display_name,e.classList.remove("loading"),e.classList.add("success"),e.innerHTML='<i class="fas fa-check"></i><span>Detected</span>',setTimeout(()=>{e.classList.remove("success"),e.innerHTML='<i class="fas fa-map-marker-alt"></i><span>Use GPS</span>',e.disabled=!1},2e3),this.showSuccess("Location detected from GPS!")):(t.value="".concat(s.toFixed(6),", ").concat(a.toFixed(6)),e.classList.remove("loading"),e.classList.add("success"),e.innerHTML='<i class="fas fa-check"></i><span>Detected</span>',setTimeout(()=>{e.classList.remove("success"),e.innerHTML='<i class="fas fa-map-marker-alt"></i><span>Use GPS</span>',e.disabled=!1},2e3))}catch(n){t.value="".concat(s.toFixed(6),", ").concat(a.toFixed(6)),e.classList.remove("loading"),e.classList.add("success"),e.innerHTML='<i class="fas fa-check"></i><span>Detected</span>',setTimeout(()=>{e.classList.remove("success"),e.innerHTML='<i class="fas fa-map-marker-alt"></i><span>Use GPS</span>',e.disabled=!1},2e3)}}}catch(o){console.error("Error detecting location:",o),e.classList.remove("loading"),e.classList.add("error"),e.innerHTML='<i class="fas fa-exclamation-triangle"></i><span>Failed</span>',setTimeout(()=>{e.classList.remove("error"),e.innerHTML='<i class="fas fa-map-marker-alt"></i><span>Use GPS</span>',e.disabled=!1},2e3),this.showError("Could not detect location. Please enter it manually.")}}})},loadSavedDetails(){try{const e=localStorage.getItem("checkoutDetails");if(e){const t=JSON.parse(e);if(t.name){const e=document.getElementById("customerName");e&&(e.value=t.name)}if(t.phone){const e=document.getElementById("customerPhone");e&&(e.value=t.phone)}if(t.email){const e=document.getElementById("customerEmail");e&&(e.value=t.email)}if(t.location){const e=document.getElementById("customerLocation");e&&(e.value=t.location)}const n=document.getElementById("rememberDetails");n&&(n.checked=!0),setTimeout(()=>{this.initFloatingLabels()},50)}}catch(e){console.error("Error loading saved details:",e)}},saveDetails(){const e=document.getElementById("rememberDetails");if(e&&e.checked)try{const e={name:document.getElementById("customerName")?document.getElementById("customerName").value:"",phone:document.getElementById("customerPhone")?document.getElementById("customerPhone").value:"",email:document.getElementById("customerEmail")?document.getElementById("customerEmail").value:"",location:document.getElementById("customerLocation")?document.getElementById("customerLocation").value:""};localStorage.setItem("checkoutDetails",JSON.stringify(e)),console.log("Details saved to localStorage")}catch(t){console.error("Error saving details:",t)}},showStep(e){console.log("showStep called with stepNumber:",e);document.querySelectorAll(".checkout-step").forEach(e=>e.classList.remove("active"));const t=document.getElementById("step".concat(e));t&&t.classList.add("active"),this.currentStep=e,console.log("Current step updated to:",this.currentStep),this.updateStepIndicator(),this.updateButtonStates(),2===e&&this.populateSummaryData(),3===e&&this.populateMessagePreview()},populateSummaryData(){const e=document.getElementById("customerName")?document.getElementById("customerName").value:"",t=document.getElementById("customerPhone")?document.getElementById("customerPhone").value:"",n=document.getElementById("customerLocation")?document.getElementById("customerLocation").value:"",o=document.getElementById("summaryName"),s=document.getElementById("summaryPhone"),a=document.getElementById("summaryLocation");o&&(o.textContent=e||"Not provided"),s&&(s.textContent=t?"+254".concat(t):"Not provided"),a&&(a.textContent=n||"Not provided")},populateMessagePreview(){const e=document.getElementById("customerName")?document.getElementById("customerName").value:"",t=document.getElementById("customerPhone")?document.getElementById("customerPhone").value:"",n=document.getElementById("customerLocation")?document.getElementById("customerLocation").value:"",o=this.generateWhatsAppMessage(e,t,n),s=document.getElementById("messagePreview");s&&(s.textContent=o)},nextStep(){this.currentStep<this.totalSteps&&this.showStep(this.currentStep+1)},previousStep(){this.currentStep>1&&this.showStep(this.currentStep-1)},updateStepIndicator(){const e=document.querySelectorAll(".md3-stepper .step"),t=document.querySelectorAll(".md3-stepper .rail");console.log("Updating step indicator. Current step:",this.currentStep),console.log("Found steps:",e.length,"Found rails:",t.length),e.forEach((e,t)=>{const n=t+1;e.classList.remove("is-active","completed"),n===this.currentStep?(e.classList.add("is-active"),console.log("Step ".concat(n," is now active"))):n<this.currentStep&&(e.classList.add("completed"),console.log("Step ".concat(n," is now completed")))}),t.forEach((e,t)=>{e.classList.remove("completed","active"),console.log("Rail ".concat(t+1," classes removed")),t<this.currentStep-1?(e.classList.add("completed"),console.log("Rail ".concat(t+1," is now completed"))):t===this.currentStep-1&&(e.classList.add("active"),console.log("Rail ".concat(t+1," is now active (50% filled)")))})},updateButtonStates(){const e=document.getElementById("backBtn"),t=document.getElementById("nextBtn"),n=document.getElementById("sendBtn");console.log("updateButtonStates called, currentStep:",this.currentStep),console.log("backBtn found:",!!e),e?(e.style.display="grid",console.log("Back button should be visible")):console.log("Back button not found in DOM"),t&&(1===this.currentStep?t.innerHTML='Review Order <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>':2===this.currentStep&&(t.innerHTML='Send Order <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>')),n&&(3===this.currentStep?(n.style.display="inline-flex",t&&(t.style.display="none")):(n.style.display="none",t&&(t.style.display="inline-flex")))},initFloatingLabels(){const e=document.querySelectorAll(".md3-field input");console.log("Initializing floating labels for",e.length,"inputs"),e.forEach((e,t)=>{e.placeholder&&""!==e.placeholder||(e.placeholder=" "),e.removeEventListener("input",this.updateFloatingLabel.bind(this,e)),e.removeEventListener("focus",this.updateFloatingLabel.bind(this,e)),e.removeEventListener("blur",this.updateFloatingLabel.bind(this,e)),e.addEventListener("input",()=>{this.updateFloatingLabel(e)}),e.addEventListener("focus",()=>{this.updateFloatingLabel(e)}),e.addEventListener("blur",()=>{this.updateFloatingLabel(e)}),this.updateFloatingLabel(e),console.log("Input ".concat(t+1,":"),e.id||e.name,"initialized")})},updateFloatingLabel(e){const t=e.parentElement.querySelector(".md3-label");if(!t)return void console.warn("No label found for input:",e.id||e.name);const n=e.value.trim().length>0,o=document.activeElement===e;n?e.classList.add("has-value"):e.classList.remove("has-value"),n||o?t.classList.add("floating"):t.classList.remove("floating"),n||o?e.style.setProperty("--placeholder-opacity","0"):e.style.removeProperty("--placeholder-opacity"),console.log("Updated floating label for ".concat(e.id||e.name,":"),{hasValue:n,isFocused:o,hasValueClass:e.classList.contains("has-value"),hasFloatingClass:t.classList.contains("floating")})},getModalHTML:()=>'\n\x3c!-- Checkout modal partial --\x3e\n<div id="checkoutModal" class="md3-modal" role="dialog" aria-modal="true" aria-labelledby="checkout-title" aria-describedby="checkout-desc" hidden>\n    \x3c!-- Backdrop --\x3e\n    <div class="md3-modal__backdrop" data-close-checkout></div>\n\n    \x3c!-- Dialog --\x3e\n    <div class="md3-modal__dialog" role="document">\n        \x3c!-- Top app-bar / Surface container high (MD3) --\x3e\n        <header class="md3-modal__header">\n            <button class="icon-btn" id="backBtn" aria-label="Back" data-close-checkout>\n                \x3c!-- MD3 back arrow --\x3e\n                <svg width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">\n                    <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />\n                </svg>\n            </button>\n            <div class="md3-modal__header-text">\n                <h2 id="checkout-title" class="headline">Checkout</h2>\n                <p id="checkout-desc" class="subtitle">Complete your details and confirm order</p>\n            </div>\n            <button class="icon-btn danger" id="closeCheckoutModal" aria-label="Close" data-close-checkout>\n                <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">\n                    <path d="M18 6L6 18M6 6l12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />\n                </svg>\n            </button>\n        </header>\n\n        \x3c!-- Stepper (MD3 Segmented progress) --\x3e\n        <div class="md3-stepper" aria-label="Checkout steps">\n            <div class="step is-active" data-step="1">\n                <span class="dot">1</span>\n                <span class="label">Details</span>\n            </div>\n            <div class="rail"></div>\n            <div class="step" data-step="2">\n                <span class="dot">2</span>\n                <span class="label">Review</span>\n            </div>\n            <div class="rail"></div>\n            <div class="step" data-step="3">\n                <span class="dot">3</span>\n                <span class="label">Send</span>\n            </div>\n        </div>\n\n        \x3c!-- Content: Glass surface container + form --\x3e\n        <div class="md3-modal__body">\n            \x3c!-- Step 1: Customer Details --\x3e\n            <section id="step1" class="section checkout-step active">\n                <h3 class="section-title">Your Details</h3>\n\n                \x3c!-- Name (MD3 filled text field) --\x3e\n                <label class="md3-field filled">\n                    <span class="md3-label">Name</span>\n                    <input type="text" inputmode="text" placeholder=" " id="customerName" autocomplete="name" />\n                    <span class="md3-support"></span>\n                </label>\n\n                \x3c!-- Phone (prefix + input) --\x3e\n                <div class="md3-field-group">\n                    <label class="md3-prefix">\n                        <span class="flag">🇰🇪</span>\n                        <span class="code">+254</span>\n                    </label>\n                    <label class="md3-field filled flex-1">\n                        <span class="md3-label">Phone</span>\n                        <input type="tel" inputmode="tel" placeholder=" " id="customerPhone" autocomplete="tel" />\n                    </label>\n                </div>\n\n                <button class="btn btn-elevated detect" id="detectPhoneBtn">Detect</button>\n\n                \x3c!-- Location --\x3e\n                <label class="md3-field filled">\n                    <span class="md3-label">Location</span>\n                    <input type="text" inputmode="text" placeholder=" " id="customerLocation" autocomplete="address-line1 country-name" />\n                    <span class="md3-support"></span>\n                </label>\n\n                <button class="btn btn-elevated detect" id="detectLocationBtn">Detect</button>\n\n                <label class="md3-checkbox">\n                    <input type="checkbox" id="rememberDetails" checked />\n                    <span class="box"></span>\n                    <span class="label">Remember my details</span>\n                </label>\n            </section>\n\n            \x3c!-- Step 2: Order Summary --\x3e\n            <section id="step2" class="section checkout-step">\n                <h3 class="section-title">Review Order</h3>\n\n                <div class="contact-summary">\n                    <h4>Contact Information</h4>\n                    <div class="contact-details">\n                        <div class="contact-item">\n                            <span class="label">Name:</span>\n                            <span id="summaryName" class="value"></span>\n                        </div>\n                        <div class="contact-item">\n                            <span class="label">Phone:</span>\n                            <span id="summaryPhone" class="value"></span>\n                        </div>\n                        <div class="contact-item">\n                            <span class="label">Location:</span>\n                            <span id="summaryLocation" class="value"></span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="order-summary">\n                    <h4>Order Items</h4>\n                    <div id="orderItems" class="order-items">\n                        \x3c!-- Order items will be populated here --\x3e\n                    </div>\n                    <div class="order-total">\n                        <span class="label">Total:</span>\n                        <span id="orderTotal" class="value"></span>\n                    </div>\n                </div>\n            </section>\n\n            \x3c!-- Step 3: Confirmation --\x3e\n            <section id="step3" class="section checkout-step">\n                <h3 class="section-title">Confirm Order</h3>\n                <p>Your order is ready to be sent via WhatsApp. Click the button below to proceed.</p>\n            </section>\n        </div>\n\n        \x3c!-- Footer --\x3e\n        <footer class="md3-modal__footer">\n            <button class="btn btn-secondary" id="backBtn" style="display: none;">Back</button>\n            <button class="btn btn-cta" id="nextBtn">\n                Review Order <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">\n                    <path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n            </button>\n            <button class="btn btn-cta" id="sendBtn" style="display: none;">\n                Send Order <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">\n                    <path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/>\n                </svg>\n            </button>\n        </footer>\n    </div>\n</div>',getBasePath:()=>window.location.pathname.includes("/Eastleigh_Turf_Grass/")?"/Eastleigh_Turf_Grass":""};export{t as checkoutModal};
//# sourceMappingURL=checkoutModal.d580fe26.js.map
